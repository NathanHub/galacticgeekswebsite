(function(){var ImagePicker,ImageUpload,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ImageUpload=function(superClass){extend(ImageUpload,superClass);function ImageUpload(){return ImageUpload.__super__.constructor.apply(this,arguments)}ImageUpload.prototype.success_params={type:"layout",thumb_size:"original"};return ImageUpload}(I.ImageUpload);ImagePicker=function(){function ImagePicker(el,editor,update){this.editor=editor;if(update==null){update=null}if(update){this.update=update}this.el=$(el);this.make_upload_btn();this.el.dispatch("click",{remove_image_btn:function(_this){return function(btn){_this.el.removeClass("has_image").find(".image_preview").css("background-image","").end().find(".image_id_input").val("").end().data("image_url","");return _this.send_update()}}(this)});this.el.on("change",function(_this){return function(e){return _this.send_update()}}(this));this.send_update()}ImagePicker.prototype.upload_prefix=function(){return this.editor.upload_prefix()};ImagePicker.prototype.prepare_upload=function(fn){return typeof fn==="function"?fn():void 0};ImagePicker.prototype.update=function(){};ImagePicker.prototype.send_update=function(){var i,len,name,option,opts,ref,url;name=this.el.data("image_name");url=this.el.data("image_url");if(!url){return this.update(name,void 0)}opts={url:url};ref=this.el.find(".image_option");for(i=0,len=ref.length;i<len;i++){option=ref[i];option=$(option);opts[option.data("name")]=option.find("select").val()}return this.update(name,opts)};ImagePicker.prototype.make_upload_btn=function(){var btn;if(this.upload_btn){return}this.progress_inner||(this.progress_inner=this.el.find(".progress_inner"));btn=this.el.find(".upload_image_btn");return this.upload_btn=I.make_popup_upload_button(this,btn,ImageUpload,{start_uploading:function(_this){return function(){_this.progress_inner.css({width:""});return _this.el.addClass("uploading")}}(this),finish_upload:function(_this){return function(upload,file){_this.el.removeClass("uploading").addClass("has_image").find(".image_preview").css("background-image","url("+file.url+")").end().find(".image_id_input").val(file.id).end().data("image_url",file.url);return _this.send_update()}}(this)})};return ImagePicker}();I.AppearanceEditor=function(){AppearanceEditor.ImageUpload=ImageUpload;AppearanceEditor.ImagePicker=ImagePicker;function AppearanceEditor(el,data){this.data=data;this.set_height=bind(this.set_height,this);this.css_template=bind(this.css_template,this);this.el=$(el);this.style=_.extend({},this.data);this.refresh_style=_.debounce(function(_this){return function(){return _this.constructor.prototype.refresh_style.apply(_this,arguments)}}(this),0);this.setup_color_picker();this.setup_image_picker();this.setup_text_areas();this.setup_form();this.el.dispatch("click",{toggle_editor_btn:function(_this){return function(){return _this.toggle()}}(this)});if(window.location.hash.match(/\bedit\b/)){_.defer(function(_this){return function(){return _this.toggle()}}(this))}$(window).on("resize",_.debounce(function(_this){return function(){return _this.set_height()}}(this),100))}AppearanceEditor.prototype.css_template=function(){var template_code;if(!this.css_template_fn){template_code=this.el.data("css_template");if(!template_code){return}this.css_template_fn=eval(template_code)}return this.css_template_fn.apply(this,arguments)};AppearanceEditor.prototype.set_height=function(){var html_h,inner,inner_h,real_height,win_h;inner=this.el.find(".appearance_editor_inner");html_h=$("html").outerHeight(true);win_h=$(window).height();inner_h=inner.outerHeight(true);if(inner_h>win_h){real_height=Math.max(html_h,win_h,inner_h);return this.el.height(real_height).css({bottom:"",position:""})}else{return this.el.height("").css({bottom:"0",position:"fixed"})}};AppearanceEditor.prototype.toggle=function(){var body;body=$(document.body).toggleClass("show_appearance_editor");this.set_height();this.el.addClass("animating");return setTimeout(function(_this){return function(){_this.el.removeClass("animating");return _this.set_height()}}(this),200)};AppearanceEditor.prototype.refresh_style=function(){};AppearanceEditor.prototype.upload_prefix=function(){throw"override me"};AppearanceEditor.prototype.update_image=function(name,image){this.style[name]=image;return this.refresh_style()};AppearanceEditor.prototype.update_color=function(name,color){this.style[name]=color;return this.refresh_style()};AppearanceEditor.prototype.setup_form=function(){return this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "))}}}(this))};AppearanceEditor.prototype.setup_text_areas=function(){return this.el.on("focusin focusout",".text_field",function(_this){return function(e){return $(e.currentTarget).toggleClass("open",e.type==="focusin")}}(this))};AppearanceEditor.prototype.setup_image_picker=function(){var el,image_pickers;image_pickers=this.el.find(".image_picker");return this.image_pickers=function(){var i,len,results;results=[];for(i=0,len=image_pickers.length;i<len;i++){el=image_pickers[i];results.push(new ImagePicker($(el),this,function(_this){return function(){return _this.update_image.apply(_this,arguments)}}(this)))}return results}.call(this)};AppearanceEditor.prototype.setup_color_picker=function(){var i,len,picker,pickers;this.el.dispatch("click",{color_preview:function(_this){return function(btn){return _this.open_color_picker(btn.closest(".color_picker"))}}(this)});this.el.on("click",".color_picker .close_btn",function(_this){return function(e){var picker;picker=$(e.target).closest(".color_picker");return picker.data("close")()}}(this));this.el.find("input[type='text']").on("focus",function(_this){return function(e){return _this.open_color_picker($(e.target).closest(".color_picker"),false)}}(this));pickers=this.el.find(".color_picker");for(i=0,len=pickers.length;i<len;i++){picker=pickers[i];picker=$(picker);this.set_picker_color(picker,this.style[picker.find("[data-name]").data("name")])}pickers.on("keyup","input",function(_this){return function(e){var color,ref;color=$(e.currentTarget).val();return(ref=$(e.delegateTarget).data("farb"))!=null?ref.setColor(color):void 0}}(this));return pickers.on("change","input",function(_this){return function(e){var color,ref;picker=$(e.delegateTarget);if(color=(ref=picker.data("farb"))!=null?ref.color:void 0){return picker.find("input").val(color)}}}(this))};AppearanceEditor.prototype.set_picker_color=function(picker,color){var farb,h,input,l,preview,ref,s;farb=picker.data("farb")||new $._farbtastic($());input=picker.find("input");if(color){input.val(color)}else{color=input.val()}preview=picker.find(".color_preview");input=picker.find("input");ref=farb.RGBToHSL(farb.unpack(color)),h=ref[0],s=ref[1],l=ref[2];preview.toggleClass("is_bright",l>.9);preview.css("backgroundColor",color);return this.update_color(picker.find("[data-name]").data("name"),color)};AppearanceEditor.prototype.open_color_picker=function(picker,toggle){var base,farb,i,input,len,other_picker,popup,preview,ref;if(toggle==null){toggle=true}if(picker.is(".flyout_open")){if(toggle){picker.data("close")()}return false}ref=this.el.find(".color_picker");for(i=0,len=ref.length;i<len;i++){other_picker=ref[i];if(typeof(base=$(other_picker).data("close"))==="function"){base()}}popup=$('<div class="color_popup input_flyout">\n  <div class="close_btn">&times;</div>\n  <div class="farb"></div>\n</div>');input=picker.find("input");preview=picker.find(".color_preview");picker.data("close",function(_this){return function(){popup.removeClass("open");picker.removeClass("flyout_open").removeData("farb");$(document.body).off("click.color_picker");$(window).off("keydown.color_picker");return setTimeout(function(){return popup.remove()},200)}}(this));farb=$.farbtastic(popup.find(".farb"),function(_this){return function(color){return _this.set_picker_color(picker,color)}}(this));picker.data("farb",farb);farb.setColor(input.val());$(document.body).on("click.color_picker",function(_this){return function(e){if($(e.target).closest(".color_picker").length){return}return picker.data("close")()}}(this));$(window).on("keydown.color_picker",function(_this){return function(e){if(e.keyCode===27){return picker.data("close")()}}}(this));picker.append(popup).addClass("flyout_open");return _.defer(function(_this){return function(){return popup.addClass("open")}}(this))};return AppearanceEditor}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.AddGameToJamForm=function(){function AddGameToJamForm(el,opts){if(opts==null){opts={}}this.setup_badge_fields=bind(this.setup_badge_fields,this);this.setup_public_domain_fields=bind(this.setup_public_domain_fields,this);this.opts=$.extend({remote_submit:false},opts);this.el=$(el);this.form=this.el.is("form")&&this.el||this.el.find("form");this.setup_remote_submit();this.setup_public_domain_fields();this.setup_badge_fields();this.setup_game_picker()}AddGameToJamForm.prototype.setup_game_picker=function(){var game_id_input,update_game_id,url_template;game_id_input=this.el.find(".game_id_input");if(!game_id_input.length){return}url_template=_.template(this.form.attr("action"));update_game_id=function(_this){return function(){var url;if(!game_id_input.length){return}url=url_template({game_id:game_id_input.val()});return _this.form.attr("action",url)}}(this);update_game_id();return game_id_input.on("change",update_game_id)};AddGameToJamForm.prototype.setup_remote_submit=function(){if(!this.opts.remote_submit){return}$('<input type="hidden" name="json" value="true" />').appendTo(this.form);return this.form.remote_submit(function(_this){return function(res){var base;if(res.errors){return alert(res.errors.join(", "))}return typeof(base=_this.opts).on_submit==="function"?base.on_submit(res):void 0}}(this))};AddGameToJamForm.prototype.setup_public_domain_fields=function(){var data,field,i,len,ref,val;this.el.on("change",".field_type_public_domain",function(_this){return function(e){var field,val_input;field=$(e.currentTarget);val_input=field.find(".field_value");return val_input.val(field.find(".public_domain_toggle").is(":checked")?JSON.stringify([field.find(".country_input").val()]):"")}}(this));ref=this.el.find(".field_type_public_domain");for(i=0,len=ref.length;i<len;i++){field=ref[i];field=$(field);val=field.find(".field_value").val();try{data=JSON.parse(val)}catch(error){}if(!data){return}field.find(".public_domain_toggle").prop("checked",true);field.find("option[value='"+data[0]+"']").prop("selected",true)}};AddGameToJamForm.prototype.setup_badge_fields=function(){var data,field,i,idx,j,len,len1,ref,toggle,val;this.el.on("change",".field_type_badges",function(_this){return function(e){var el,field,selected,val_input;field=$(e.currentTarget);val_input=field.find(".field_value");selected=function(){var i,len,ref,results;ref=field.find("input.badge_toggle:checked");results=[];for(i=0,len=ref.length;i<len;i++){el=ref[i];results.push(""+$(el).data("choice_idx"))}return results}();return val_input.val(selected.length?JSON.stringify(selected):"")}}(this));ref=this.el.find(".field_type_badges");for(i=0,len=ref.length;i<len;i++){field=ref[i];field=$(field);val=field.find(".field_value").val();try{data=JSON.parse(val)}catch(error){}if(!data){return}for(j=0,len1=data.length;j<len1;j++){idx=data[j];toggle=field.find("[data-choice_idx='"+idx+"']");toggle.prop("checked",true)}}};return AddGameToJamForm}()}).call(this);(function(){I.JamAdmin=function(){function JamAdmin(el,jam){var appearance_editor;this.jam=jam;this.el=$(el);appearance_editor=this.el.find(".appearance_editor_widget");if(appearance_editor.length){this.appearance_editor=new I.JamAppearanceEditor(appearance_editor,{},this.jam)}this.el.dispatch("click",{edit_theme_btn:function(_this){return function(btn){return _this.appearance_editor.toggle()}}(this)})}return JamAdmin}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.JamAppearanceEditor=function(superClass){extend(JamAppearanceEditor,superClass);function JamAppearanceEditor(_a,_b,jam){this.jam=jam;this.refresh_style=bind(this.refresh_style,this);JamAppearanceEditor.__super__.constructor.apply(this,arguments);this.page=$(".view_jam_page");this.css_input=this.el.find(".css_input").on("change",function(_this){return function(){return _this.refresh_style()}}(this)).on("keyup",_.debounce(function(_this){return function(){return _this.refresh_style()}}(this),300))}JamAppearanceEditor.prototype.upload_prefix=function(){return"/jam/"+this.jam.id};JamAppearanceEditor.prototype.refresh_style=function(){var background_image_css,banner_image,bg_highlight,bg_sub,body_border_color,button_bg_color,button_fg_color,button_shadow,css,custom_css,img,inside_bg,link_highlight,link_sub,position,ref,text_sub_1,text_sub_2;banner_image=this.style.banner_image;this.page.toggleClass("has_banner",!!banner_image);if(banner_image){this._banner_el||(this._banner_el=this.page.find(".jam_banner"));this._banner_el.attr("src",banner_image.url).toggleClass("full_width",banner_image.size==="full")}this._style||(this._style=$("#jam_theme"));inside_bg=this.style.bg_color2;bg_sub=I.Color.sub_color2(inside_bg,.1);bg_highlight=I.Color.sub_color2(bg_sub,.05);text_sub_1=I.Color.sub_color2(inside_bg,.6);text_sub_2=I.Color.sub_color2(inside_bg,.45);link_highlight=I.Color.sub_color2(this.style.link_color,.05);link_sub=I.Color.sub_color2(this.style.link_color,-.05);button_fg_color=I.Color.readable_text_color(this.style.link_color);button_bg_color=this.style.link_color;if(button_bg_color==="#dd4a4a"){button_bg_color="#FA5C5C"}button_shadow=I.Color.sub_color2(button_bg_color,.17,.2);background_image_css=(img=this.style.background_image)?(position=function(){var ref;switch((ref=this.style.background_image)!=null?ref.position:void 0){case"align_left":return"0% 0%";case"align_right":return"100% 0%";case"align_center":return"50% 0%";default:return"0% 0%"}}.call(this),'background-image: url("'+img.url+'");\nbackground-repeat: '+(img.repeat||"repeat")+";\nbackground-position: "+position+";"):"";custom_css=I.strip_css(this.css_input.val()||"");body_border_color=this.style.bg_color===this.style.bg_color2&&!this.style.background_image?bg_sub:"transparent";css=this.css_template({text_color:this.style.text_color,bg_color:this.style.bg_color,bg_color2:this.style.bg_color2,link_color:this.style.link_color,body_border_color:body_border_color,button_shadow:button_shadow,background_image_css:background_image_css,button_fg_color:button_fg_color,button_bg_color:button_bg_color,link_highlight:link_highlight,link_sub:link_sub,bg_sub:bg_sub,bg_highlight:bg_highlight,text_sub_1:text_sub_1,text_sub_2:text_sub_2,custom_css:custom_css,mix_color:I.Color.mix_color});if((ref=this._style)!=null){ref.remove()}return this._style=$("<style type='text/css'>"+css+"</style>").appendTo($("head"))};return JamAppearanceEditor}(I.AppearanceEditor)}).call(this);(function(){I.JamsPage=function(){function JamsPage(el,jams){this.el=$(el);this.el.format_timestamps();I.libs.react.then(function(_this){return function(){return ReactDOM.render(R.Jam.JamCalendar({jams:jams}),_this.el.find("#calendar .jam_calendar")[0])}}(this))}return JamsPage}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.AddGameLightbox=function(superClass){extend(AddGameLightbox,superClass);function AddGameLightbox(){return AddGameLightbox.__super__.constructor.apply(this,arguments)}AddGameLightbox.prototype.init=function(intent){var form;this.el.toggleClass("intent_join",intent==="join").toggleClass("intent_submit",intent==="submit");form=this.el.find("form");if(!form.length){return}return new I.AddGameToJamForm(form,{remote_submit:true,on_submit:function(_this){return function(){return _this.el.addClass("submitted")}}(this)})};return AddGameLightbox}(I.Lightbox);I.JamBase=function(){function JamBase(){this.setup_buttons=bind(this.setup_buttons,this)}JamBase.prototype.setup_buttons=function(){this.el.remote_link(function(res){if(res.redirect_to){return window.location=res.redirect_to}});return this.el.dispatch("click",{join_jam_btn:function(_this){return function(btn){if(!I.current_user){I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"join")}I.ConversionTracker.join("4:"+_this.jam.id);return"continue"}}(this),add_game_btn:function(_this){return function(btn){return I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"submit")}}(this),unsubmit_btn:function(_this){return function(btn){var url;url=btn.attr("href");return $.post(url,I.with_csrf({redirect:true}),function(res){return window.location=res.redirect_to})}}(this)})};return JamBase}();I.SaltwJam=function(superClass){extend(SaltwJam,superClass);SaltwJam.prototype.start_date=new Date(Date.UTC(2013,8,13,23));SaltwJam.prototype.end_date=new Date(Date.UTC(2013,8,22,23));function SaltwJam(el){this.setup_countdown=bind(this.setup_countdown,this);this.el=$(el);new I.GameGrid(this.el.find(".game_grid_widget"),{selector:".saltw_jam_page .game_cell .game_thumb"});this.setup_countdown();this.setup_buttons()}SaltwJam.prototype.setup_countdown=function(){var now;now=new Date;if(now<this.start_date){return this.el.addClass("before_start")}else if(now>this.end_date){return this.el.addClass("after_end")}else{return this.el.addClass("during_jam")}};return SaltwJam}(I.JamBase);I.SaltwWinter2013Jam=function(superClass){extend(SaltwWinter2013Jam,superClass);function SaltwWinter2013Jam(){return SaltwWinter2013Jam.__super__.constructor.apply(this,arguments)}SaltwWinter2013Jam.prototype.start_date=new Date(Date.UTC(2013,11,20,23));SaltwWinter2013Jam.prototype.end_date=new Date(Date.UTC(2014,0,0,0));return SaltwWinter2013Jam}(I.SaltwJam);I.ViewJam=function(superClass){extend(ViewJam,superClass);function ViewJam(el,jam){this.jam=jam;this.setup_filters=bind(this.setup_filters,this);this.setup_grid=bind(this.setup_grid,this);this.setup_countdown=bind(this.setup_countdown,this);this.setup_admin=bind(this.setup_admin,this);this.el=$(el);this.setup_buttons();this.setup_grid();this.setup_countdown();this.setup_admin();this.setup_filters();this.el.format_timestamps();I.setup_grid_referrers(this.el,function(_this){return function(){return"jam:"+_this.jam.id}}(this));I.deferred_links(this.el,"a[data-label]")}ViewJam.prototype.setup_admin=function(){return new I.JamAdmin($(document.body),this.jam)};ViewJam.prototype.setup_countdown=function(){var count_to,countdown,end_date,now,start_date,voting_end_date;countdown=this.el.find(".countdown");if(!countdown.length){return}if(countdown.is(":empty")){countdown.html(this.el.find(".jam_content").data("countdown_template"))}start_date=I.parse_timestamp(this.jam.start_date);end_date=I.parse_timestamp(this.jam.end_date);if(this.jam.voting_end_date){voting_end_date=I.parse_timestamp(this.jam.voting_end_date)}now=new Date;count_to=now<start_date?start_date:now<end_date?end_date:voting_end_date&&now<voting_end_date?voting_end_date:void 0;if(count_to){return new I.Countdown(countdown,count_to)}};ViewJam.prototype.setup_grid=function(){var grid;grid=this.el.find(".browse_game_grid");if(grid.length){this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell"});return this.grid.setup_conversion_tracking("8")}};ViewJam.prototype.setup_filters=function(){var cells,filter_picker,grid,grid_outer;filter_picker=this.el.find(".jam_filter_picker");if(!filter_picker.length){return}grid_outer=filter_picker.closest(".grid_outer");grid=grid_outer.find(".browse_game_grid");cells=grid.find(".game_cell");return filter_picker.dispatch("click",{filter_item:function(_this){return function(btn){var filter,visible_cells;btn.parent().find(".filter_item").removeClass("active");btn.addClass("active");filter=btn.data("filter");visible_cells=filter?cells.hide().filter("."+filter).show():cells.show();_this.grid.refresh_images();return grid_outer.toggleClass("no_visible_games",!visible_cells.length)}}(this)})};return ViewJam}(I.JamBase);I.ViewRawJam=function(superClass){extend(ViewRawJam,superClass);function ViewRawJam(){ViewRawJam.__super__.constructor.apply(this,arguments);this.setup_status_message()}ViewRawJam.prototype.setup_status_message=function(){var status_el;status_el=this.el.find(".jam_status");if(!status_el.length){return}status_el.html(this.jam.status_html);return status_el.format_timestamps()};return ViewRawJam}(I.ViewJam)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ViewJamPlain=function(){function ViewJamPlain(el,jam){this.jam=jam;this.setup_grid=bind(this.setup_grid,this);this.setup_countdown=bind(this.setup_countdown,this);this.el=$(el);this.setup_countdown();this.setup_grid();I.has_follow_button(this.el);this.el.format_timestamps();this.el.remote_link(function(res){if(res.redirect_to){return window.location=res.redirect_to}});this.el.dispatch("click",{join_jam_btn:function(_this){return function(btn){if(!I.current_user){I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"join");return}return"continue"}}(this),add_game_btn:function(_this){return function(btn){return I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"submit")}}(this)})}ViewJamPlain.prototype.setup_countdown=function(){var count_to,countdown,end_date,now,start_date,voting_end_date;countdown=this.el.find(".countdown");if(!countdown.length){return}start_date=I.parse_timestamp(this.jam.start_date);end_date=I.parse_timestamp(this.jam.end_date);if(this.jam.voting_end_date){voting_end_date=I.parse_timestamp(this.jam.voting_end_date)}now=new Date;count_to=now<start_date?start_date:now<end_date?end_date:voting_end_date&&now<voting_end_date?voting_end_date:void 0;if(count_to){return new I.Countdown(countdown,count_to,{max_blocks:3})}};ViewJamPlain.prototype.setup_grid=function(){var grid;grid=this.el.find(".browse_game_grid");if(grid.length){return this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell"})}};return ViewJamPlain}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ViewJamRateGame=function(){function ViewJamRateGame(el,game){var input;this.game=game;this.setup_comments=bind(this.setup_comments,this);this.el=$(el);this.setup_downloads();this.setup_header();this.setup_comments();this.el.format_timestamps();input=this.el.find(".judge_feedback_input");if(input.exists()){I.redactor(input,{minHeight:100,source:false})}this.el.dispatch("click",{report_btn:function(_this){return function(btn){return I.Lightbox.open_remote_react(btn.data("lightbox_url"),function(props){return R.Game.ReportLightbox(props)})}}(this),add_to_collection_btn:function(_this){return function(btn){if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})}ViewJamRateGame.prototype.setup_comments=function(){var comment_list,input;input=this.el.find(".comment_input");if(input.length){I.redactor(input,{minHeight:100,source:false})}comment_list=this.el.find(".jam_comment_list");return comment_list.dispatch("click",{delete_comment_btn:function(_this){return function(btn){confirm("Are you sure you want to delete this comment?");return $.post(btn.data("href"),I.with_csrf(),function(res){if(res.errors){alert(res.errors.join);return}return btn.closest(".jam_comment").slideUp()})}}(this)})};ViewJamRateGame.prototype.setup_downloads=function(){var file_size,i,len,ref;ref=this.el.find(".file_size_value");for(i=0,len=ref.length;i<len;i++){file_size=ref[i];file_size=$(file_size);file_size.html(I.format_bytes(parseInt(file_size.html())))}return this.el.dispatch("click",{download_btn:function(_this){return function(btn){I.event("jam_game_download","download",""+_this.game.id);I.ConversionTracker.download("1:"+_this.game.id);I.ConversionTracker.flush_now();return $.ajax({url:"/game/download/"+_this.game.id+"/file/"+btn.data("upload_id")+"?after_download_lightbox=true",type:"post",data:I.with_csrf(),success:function(res){var err;if(res.errors){err=res.errors.join(", ");I.event("jam_game_download","error",err);alert(err);return}if(res.lightbox){I.Lightbox.open(res.lightbox,I.AfterDownloadLightbox,_this.game,{page_name:"jam_rate_game"})}return I.start_download(res)}})}}(this)})};ViewJamRateGame.prototype.setup_header=function(){return this.el.dispatch("click",{remove_submission_btn:function(_this){return function(btn){if(btn.is(".loading")){return}if(!confirm("Are you sure you want to remove this submission?")){return}btn.addClass("loading");return $.post(btn.data("href"),I.with_csrf({redirect:true}),function(res){return window.location=res.redirect_to})}}(this)})};return ViewJamRateGame}()}).call(this);(function(){I.ViewJamResults=function(){function ViewJamResults(el){this.el=$(el);this.el.lazy_images();this.el.format_timestamps()}return ViewJamResults}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.ViewJamScreenshots=function(superClass){extend(ViewJamScreenshots,superClass);ViewJamScreenshots.prototype.current_page=1;function ViewJamScreenshots(el){ViewJamScreenshots.__super__.constructor.apply(this,arguments);this.el.lazy_images()}ViewJamScreenshots.prototype.get_next_page=function(){this.current_page+=1;this.el.addClass("loading");return $.get("",{page:this.current_page,format:"json"},function(_this){return function(res){_this.el.removeClass("loading");if(res.num_items>0){$(res.content).appendTo(_this.el.find(".screenshot_grid_widget")).hide().fadeIn();return _this.el.lazy_images()}else{return _this.remove_loader()}}}(this))};return ViewJamScreenshots}(I.InfiniteScroll)}).call(this);(function(){I.libs.react.done(function(){var P,SEEN_EVENTS,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;SEEN_EVENTS={};P("ConversionLink",{pure:true,propTypes:{source:types.number,object_type:types.number,object_id:types.number,href:types.string,target:types.string,class:types.any,impression:types.bool,on_click:types.func,on_impression:types.func},getInitialState:function(){return{seen:false}},get_suffix:function(){return this.props.source+":"+this.props.object_type+":"+this.props.object_id},on_click:function(e){var el,finished,is_blank,start;if(e.type!=="click"){return}el=ReactDOM.findDOMNode(this);is_blank=e.metaKey||e.ctrlKey||e.shiftKey||this.props.target==="_blank";p=this.handle_click();if(is_blank){return}if(p.state()==="resolved"){return}e.preventDefault();start=new Date;finished=function(_this){return function(){if(!finished){return}finished=null;return window.location=_this.props.href}}(this);setTimeout(function(_this){return function(){return typeof finished==="function"?finished():void 0}}(this),200);return p.done(finished)},on_mouse_up:function(e){if(e.button!==1){return}return this.handle_click()},handle_click:function(){var base,event_name,ref;if(!(this.props.object_type&&this.props.source&&this.props.object_id)){return $.when()}if(this.state.clicked){return this.state.clicked}event_name=I.ConversionTracker.types.click+":"+this.get_suffix();if(SEEN_EVENTS[event_name]){return $.when()}SEEN_EVENTS[event_name]=true;I.ConversionTracker.click(this.get_suffix());p=I.ConversionTracker.flush_now_beacon();if(this.props.track_referrer){(ref=I.ReferrerTracker).push.apply(ref,this.props.track_referrer)}this.setState({clicked:p});if(typeof(base=this.props).on_click==="function"){base.on_click()}return p},componentDidMount:function(){var el;if(!(this.props.object_type&&this.props.source&&this.props.object_id)){return}if(this.props.impression===false){return}if(SEEN_EVENTS[I.ConversionTracker.types.impression+":"+this.get_suffix()]){return}el=ReactDOM.findDOMNode(this);return this.unbind_visibility=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base,event_name;event_name=I.ConversionTracker.types.impression+":"+_this.get_suffix();if(!SEEN_EVENTS[event_name]){I.ConversionTracker.push(event_name);SEEN_EVENTS[event_name]=true}_this.setState({seen:true});if(typeof(base=_this.props).on_impression==="function"){base.on_impression()}if(typeof _this.unbind_visibility==="function"){_this.unbind_visibility()}return _this.unbind_visibility=null}}(this)})},componentWillUnmount:function(){return typeof this.unbind_visibility==="function"?this.unbind_visibility():void 0},render:function(){return a({href:this.props.href,className:this.props["class"]||this.props.className,onClick:this.on_click,onMouseUp:this.on_mouse_up,target:this.props.target,tabIndex:this.props.tabindex},this.props.children)}})})}).call(this);(function(){I.libs.react.done(function(){var P,PLATFORM_ICONS,PLATFORM_NAMES,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;PLATFORM_ICONS={linux:"tux",osx:"apple",windows:"windows8",android:"android"};PLATFORM_NAMES={linux:"Linux",osx:"macOS",windows:"Windows",android:"Android"};P("PlatformList",{pure:true,getDefaultProps:function(){return{prefix:"Available for"}},render:function(){var j,len,name,out,ref;if(!(this.props.platforms&&this.props.platforms.length)){return null}out=[];ref=this.props.platforms;for(j=0,len=ref.length;j<len;j++){name=ref[j];if(out.length>0){out.push(" ")}out.push(span({key:name,className:"icon icon-"+PLATFORM_ICONS[name],title:this.props.prefix+" "+PLATFORM_NAMES[name]}))}return out}});P("StarRating",{propTypes:{average:types.number,count:types.number},pure:true,render:function(){var i;return div({className:"game_rating"},div({className:"star_value"},div({className:"star_fill"},function(){var j,results;results=[];for(i=j=1;j<=5;i=++j){results.push(span({key:i,className:"star icon-star"}))}return results}()),div({className:"star_holes"},function(){var j,results;results=[];for(i=j=1;j<=5;i=++j){results.push(span({key:i,className:"star icon-star2"}))}return results}()))," ",span({title:(this.props.average||0).toFixed(2),className:"rating_count"},"("+I.format_integer(this.props.count)+")"))}});P("GameCell",{pure:true,getDefaultProps:function(){return{show_price:true,show_short_text:true,show_platforms:true,show_rating:true,show_cell_tools:true}},getInitialState:function(){return{game:this.build_game()}},componentDidUpdate:function(prev_props){if(prev_props.build_game_object!==this.props.build_game_object||prev_props.game!==this.props.game){return this.setState({game:this.build_game()})}},build_game:function(){if(this.props.build_game_object){return this.props.build_game_object(this.props.game)}else{return this.props.game}},add_to_collection:function(e){if(I.current_user){e.preventDefault();return I.Lightbox.open_remote("/game/collections/"+this.state.game.id,I.CollectionLightbox)}},mark_gif_loaded:function(){return this.setState({gif_loaded:true})},track_grid_referrer:function(){if(!this.props.grid_referrer){return}return I.ReferrerTracker.push("game",this.state.game.id,this.props.grid_referrer)},game_link:function(){var children,link_props,props;props=arguments[0],children=2<=arguments.length?slice.call(arguments,1):[];if(this.props.conversion_source){link_props=$.extend({object_type:1,object_id:this.state.game.id,source:this.props.conversion_source,on_click:this.props.grid_referrer?this.track_grid_referrer:void 0},props);return P.ConversionLink.apply(P,[link_props].concat(slice.call(children)))}return a.apply(null,[props].concat(slice.call(children)))},render_user:function(user,key){if(key==null){key=null}return a({key:key,className:"user_link",href:user.url,target:this.props.target},user.name)},render:function(){var b,base,base1,base2,cover_color,g,game,plat,platforms,r,ref,ref1,user;game=this.state.game;user=game.user;platforms=game.platforms?function(){var j,len,ref,results;ref=game.platforms;results=[];for(j=0,len=ref.length;j<len;j++){plat=ref[j];if(PLATFORM_ICONS[plat]){results.push(plat)}}return results}():void 0;cover_color=game.cover_color&&I.Color?(ref=I.Color.parse_color(game.cover_color),r=ref[0],g=ref[1],b=ref[2],ref,"rgba("+r+", "+g+", "+b+", 0.5)"):void 0;return this.enclose({"data-game_id":game.id,dir:"auto",className:"game_cell",onMouseEnter:this.state.game.gif_cover?function(_this){return function(){return _this.setState({hovering:true})}}(this):void 0,onMouseLeave:this.state.game.gif_cover?function(_this){return function(){return _this.setState({hovering:false})}}(this):void 0},div({className:"bordered",style:cover_color&&{backgroundColor:cover_color}},this.game_link({href:game.url,target:this.props.target,className:"game_thumb"},typeof(base=this.props).render_thumb_extras==="function"?base.render_thumb_extras(game):void 0,game.cover?P.LazyImage({src:game.cover}):div({className:"missing_image"},"no image :("),game.gif_cover?div({className:"gif_label"},"GIF"):void 0,((ref1=this.state)!=null?ref1.hovering:void 0)&&game.gif_cover?React.createElement(React.Fragment,{},!this.state.gif_loaded?div({className:"gif_loading_overlay"}):void 0,P.LazyImage({className:"gif_cover",src:game.gif_cover,on_load:this.mark_gif_loaded})):void 0),this.props.show_price&&game.sale_rate?div({className:classNames("sale_flag",{reverse_sale:game.sale_rate<0})},div({className:"rate"},Math.abs(game.sale_rate)+"%"),div({className:"mini_label"},game.sale_rate<0?"more":"off")):void 0,(platforms!=null?platforms.length:void 0)?div({className:"p_data fading_data"},P.PlatformList({platforms:platforms})):void 0,this.props.show_cell_tools?div({className:"fading_data cell_tools"},typeof(base1=this.props).render_cell_extras==="function"?base1.render_cell_extras(game):void 0,a({href:game.url+"/add-to-collection",title:this.t("add_to_collection.add_button"),className:"add_to_collection_btn",onClick:this.add_to_collection},span({className:"icon icon-playlist_add"}))):void 0),div({className:"label"},function(){if(this.props.show_price){switch(game.flag){case"free":return div({className:"meta_tag free_tag"},"Free");case"web":return div({className:"meta_tag free_tag"},"Web");case"demo":return div({className:"meta_tag demo_tag"},"Demo");default:if(game.price){return div({className:classNames("price_tag meta_tag")},game.price)}}}}.call(this),this.game_link({target:this.props.target,className:"title",title:game.title,href:game.url},game.title)),div({className:"user_row"},game.contributors?game.contributors.map(function(_this){return function(user,idx){if(idx>0){return fragment({key:"user-"+idx},", ",_this.render_user(user))}else{return _this.render_user(user,"user-"+idx)}}}(this)):this.render_user(user)),this.props.show_rating&&game.rating?P.StarRating(game.rating):void 0,game.tags&&game.tags.length?div({className:"sub cell_tags"},game.tags.map(function(_this){return function(tag,idx){return React.createElement(React.Fragment,{key:tag.name},idx>0?", ":void 0,a({href:tag.url,target:_this.props.target},"#"+tag.name))}}(this))):void 0,this.props.show_short_text?game.short_text?div({className:"sub short_text"},game.short_text):void 0:void 0,typeof(base2=this.props).render_cell_below==="function"?base2.render_cell_below(game):void 0)}});P("GameGrid",{calculate_cell_sizes:function(_this){return function(){var ref,ref1;return(ref=_this.grid_sizer_ref)!=null?(ref1=ref.current)!=null?ref1.calculate_cell_sizes():void 0:void 0}}(this),componentDidMount:function(){var container;container=this.container();if(this.props.enable_popups){return new I.GamePopups(container,{x_offset:10})}},getDefaultProps:function(){return{cell_width:I.is_mobile()?300:250,enable_popups:true,render_game:function(game){var cell_props;cell_props={render_thumb_extras:this.props.render_thumb_extras,render_cell_extras:this.props.render_cell_extras,render_cell_below:this.props.render_cell_below,key:game.id,game:game,build_game_object:this.props.build_game_object,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer};if(this.props.cell_props){cell_props=$.extend(cell_props,this.props.cell_props)}return P.GameCell(cell_props)}}},render:function(){var props,ref;props={ref:this.grid_sizer_ref||(this.grid_sizer_ref=React.createRef()),cell_margin:10,expected_width:this.props.cell_width,fit_rows:this.props.fit_rows,children:(ref=this.props.games)!=null?ref.map(this.props.render_game.bind(this)):void 0};if(this.props.grid_sizer_props){props=$.extend(props,this.props.grid_sizer_props)}return this.enclose({},P.GridSizer(props))}});P("NewFromFollowers",{getInitialState:function(){return{games:this.props.games}},componentDidUpdate:function(prev_props,prev_state){var ref,ref1;if(((ref=prev_state.games)!=null?ref.length:void 0)!==((ref1=this.state.games)!=null?ref1.length:void 0)){return $(window).trigger("i:reshape")}},on_dismiss_games:function(e){var g,grid_sizer,ref,ref1,ref2,ref3,visible_games;if((ref=this.state)!=null?ref.loading:void 0){return}grid_sizer=(ref1=this.game_grid_ref)!=null?(ref2=ref1.current)!=null?(ref3=ref2.grid_sizer_ref)!=null?ref3.current:void 0:void 0:void 0;if(!grid_sizer){return}visible_games=this.state.games.slice(0,grid_sizer.get_num_visible());if(!visible_games.length){return}this.setState({loading:true});return $.post(this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:function(){var j,len,results;results=[];for(j=0,len=visible_games.length;j<len;j++){g=visible_games[j];results.push(g.id)}return results}().join(",")})).done(function(_this){return function(res){return $.get(_this.props.more_results_url).done(function(more_games){return _this.setState({games:_.toArray(more_games.games),loading:false})})}}(this))},render_cell_extras:function(game){return button({type:"button",className:"dismiss_btn",onClick:function(_this){return function(){var g,remaining_games;remaining_games=function(){var j,len,ref,results;ref=this.state.games;results=[];for(j=0,len=ref.length;j<len;j++){g=ref[j];if(g!==game){results.push(g)}}return results}.call(_this);_this.setState({games:remaining_games});return $.post(_this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:game.id})).done(function(res){return _this.fetch_more_if_necessary()})}}(this)},"Dismiss")},fetch_more_if_necessary:function(){var grid,ref,ref1,ref2;if(this.state.loading){return}if(this.state.exhausted){return}grid=(ref=this.game_grid_ref)!=null?(ref1=ref.current)!=null?(ref2=ref1.grid_sizer_ref)!=null?ref2.current:void 0:void 0:void 0;if(!grid){return}if(!(grid.get_max_num_visible()>grid.get_num_visible())){return}this.setState({loading:true});return $.get(this.props.more_results_url).done(function(_this){return function(more_games){more_games=_.toArray(more_games!=null?more_games.games:void 0);return _this.setState({exhausted:more_games.length<grid.get_max_num_visible(),games:more_games,loading:false})}}(this))},render_dismiss_button:function(){var games;games=this.state.games;if(!games.length){return}return button({className:"button outline",type:"button",onClick:this.on_dismiss_games},this.state.games.length>1?"Dismiss these":"Dismiss")},render:function(){var ref;if(!this.state.games.length){return null}return this.enclose({className:classNames({loading:(ref=this.state)!=null?ref.loading:void 0})},div({className:"header_split"},div({},div({className:"section_header"},h2({},"New From Those You Follow")),p({className:"section_description"},"Projects from those you follow that you haven't seen yet.")),this.render_dismiss_button()),P.GameGrid({ref:this.game_grid_ref||(this.game_grid_ref=React.createRef()),games:this.state.games,fit_rows:this.props.fit_rows,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,render_cell_extras:this.render_cell_extras}))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,id_incr,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;id_incr=0;P("GridSizer",{propTypes:{children:types.array},getInitialState:function(){return{element_id:this.enclosing_class_name()+"_"+id_incr++}},getDefaultProps:function(){return{cell_margin:20,min_width:0,expected_width:315,min_columns:1,crop_on_resize:true}},componentDidMount:function(){_.defer(function(_this){return function(){return _this.calculate_cell_sizes()}}(this));this.resize_callback=_.debounce(function(_this){return function(){return _this.calculate_cell_sizes()}}(this),250);return $(window).on("resize",this.resize_callback)},componentWillUnmount:function(){this.unmounted=true;return $(window).off("resize",this.resize_callback)},componentDidUpdate:function(prev_props){if(prev_props.children!==this.props.children){return _.defer(function(_this){return function(){return _this.calculate_cell_sizes()}}(this))}},calculate_cell_sizes:function(recurse){var calculated_width,container_width,new_width,num_cells,real_num_cells,real_width;if(recurse==null){recurse=false}if(this.unmounted){return}container_width=this.get_width();if(this.state.container_width===container_width){return}real_width=this.props.expected_width+this.props.cell_margin;calculated_width=container_width+this.props.cell_margin;num_cells=calculated_width/real_width;real_num_cells=Math.ceil(num_cells);if(real_num_cells<this.props.min_columns){real_num_cells=this.props.min_columns}new_width=calculated_width/real_num_cells-this.props.cell_margin;new_width=Math.floor(new_width);if(new_width<this.props.min_width&&real_num_cells>1){real_num_cells-=1;new_width=calculated_width/real_num_cells-this.props.cell_margin;new_width=Math.floor(new_width)}this.setState({container_width:container_width,cell_width:new_width,cells_per_row:real_num_cells},this.props.on_reshape);if(recurse===false){return _.defer(function(_this){return function(){return _this.calculate_cell_sizes(true)}}(this))}},get_width:function(){var el,fraction_el,out,r,ref;el=this.container();fraction_el=(ref=el[0])!=null?ref.getBoundingClientRect().width:void 0;r=fraction_el-Math.floor(fraction_el);out=Math.floor(el.width());if(r>0){out-=1}return out},get_max_num_visible:function(){if(this.props.fit_rows&&this.state.cells_per_row){return this.state.cells_per_row*this.props.fit_rows}},get_num_visible:function(){var num_children;num_children=this.props.children.length;if(this.props.fit_rows&&this.state.cells_per_row){return Math.min(num_children,this.state.cells_per_row*this.props.fit_rows)}else{return num_children}},get_visible_children:function(){var children;children=this.props.children;if(this.props.fit_rows&&this.state.cells_per_row){children=children.slice(0,this.state.cells_per_row*this.props.fit_rows)}return children},render:function(){var children,container_style,sizer_fixed_width;children=this.get_visible_children();container_style=this.props.crop_on_resize?{overflowX:"hidden"}:void 0;sizer_fixed_width=this.props.crop_on_resize?{width:this.state.container_width+"px"}:void 0;return this.enclose({id:this.state.element_id,component:this.props.component,style:container_style},this.state.container_width?React.createElement(this.props.component||"div",{className:"grid_sizer_children",style:sizer_fixed_width},children):void 0,this.state.cell_width?React.createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"#"+this.state.element_id+" > .grid_sizer_children > * {\n  display: inline-block;\n  vertical-align: top;\n  width: "+this.state.cell_width+"px;\n  margin-right: "+this.props.cell_margin+"px;\n}\n\n#"+this.state.element_id+" > .grid_sizer_children > *:nth-child("+this.state.cells_per_row+"n) {\n  margin-right: 0;\n}"}}):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;P("LazyImage",{pure:true,propTypes:{src:types.string,src_set:types.string,width:types.number,height:types.number},getInitialState:function(){return{visible:false}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_lazy_images=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base;_this.setState({visible:true});return typeof(base=_this.props).on_reveal==="function"?base.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images==="function"?this.unbind_lazy_images():void 0},render:function(){var ref,ref1;return img({className:classNames(this.props["class"],this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(ref=this.props.initial_width)!=null?ref:this.props.width,height:this.state.loaded?this.props.height:(ref1=this.props.initial_height)!=null?ref1:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(_this){return function(){var base;_this.setState({loaded:true});return typeof(base=_this.props).on_load==="function"?base.on_load():void 0}}(this):void 0})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Game");types=PropTypes;P("ReportLightbox",{pure:true,render:function(){var ref;return R.Lightbox({className:this.enclosing_class_name()},((ref=this.state)!=null?ref.submitted:void 0)?this.render_after_submit():this.render_report_form())},get_report_options:function(){var out;out=[["broken","Broken","Doesn't run, download, or crashes"],["offensive","Offensive material"],["doesnt_own","Uploader not authorized to distribute"],["miscategorized","Miscategorized","Shows up on wrong part of itch.io, incorrect tags, incorrect platforms, etc."],["spam","Spam"],["other",this.tt("game.report_form.reason_other")]];if(this.props.jam){out.unshift(["invalid_jam_submission","Invalid jam submission","Empty or incomplete page, breaks rules, etc."])}return out},render_report_form:function(){var ref,ref1,ref2,ref3,ref4;return fragment({},h2({},this.tt("game.report_form.title",{page_title:this.props.page_title})),form({className:"form",method:"post",action:this.props.submit_url,onSubmit:function(_this){return function(e){e.preventDefault();_this.setState({errors:null,loading:true});return I.remote_submit($(e.target)).done(function(res){if(res.errors){_this.setState({loading:false,errors:res.errors});return}return _this.setState({submitted:true})})}}(this)},R.CSRF({}),this.props.support_email||this.props.support_link?p({className:"support_notice"},this.tt("game.report_form.support_from_creator")," ",this.props.support_link?a({rel:"nofollow",target:"blank",className:"forward_link",href:this.props.support_link},this.tt("game.report_form.support_page_link")):a({rel:"nofollow",target:"blank",className:"forward_link",href:"mailto:"+this.props.support_email},this.tt("game.report_form.email_creator_link"))):void 0,((ref=this.state)!=null?ref.errors:void 0)?R.Forms.FormErrors({errors:this.state.errors,animated:true,scroll_into_view:true}):void 0,p({},this.tt("game.report_form.form_description")),this.props.jam?p({},"This report will be made available to hosts of ",a({href:this.props.jam.url},this.props.jam.name),"."):void 0,div({className:"input_row"},div({className:"label"},this.tt("game.report_form.reason_label")),R.Forms.RadioButtons({name:"report[reason]",value:((ref1=this.state)!=null?ref1.reason:void 0)||"",onChange:function(_this){return function(e){return _this.setState({reason:e.target.value})}}(this),options:this.get_report_options()})),((ref2=this.state)!=null?ref2.reason:void 0)==="doesnt_own"?div({className:"input_row"},strong({},"Are you the copyright owner and need to file a DMCA notice?")," ",a({target:"_blank",href:this.props.itchio_support_url,className:"forward_link"},"Contact our support team so we can step you through the process")):void 0,div({className:"input_row"},label({},div({className:"label"},this.tt("game.report_form.description_label"),span({className:"sub"},"  ",this.description_description())),textarea({maxLength:"2048",name:"report[description]",required:this.description_required(),placeholder:this.description_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}))),R.Forms.TextInputRow({title:"Your email",sub:"If your report needs a reply we'll use it to communicate with you",name:"report[email]",defaultValue:this.props.current_user_email,required:this.email_required(),placeholder:this.email_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}),div({callback:"buttons"},button({disabled:(ref3=this.state)!=null?ref3.loading:void 0,className:classNames("button",{disabled:(ref4=this.state)!=null?ref4.loading:void 0})},this.tt("game.report_form.submit_report_button")))))},render_after_submit:function(){return div({className:"report_submitted"},h2({},this.tt("game.report_form.report_received_header")),p({},"You report will be reviewed shortly, and action will be taken if necessary. If you have any additional requests then you can ",a({href:this.props.itchio_support_url,target:"_blank"},"contact our support team"),"."),p({},button({type:"button",className:"textlike",onClick:function(_this){return function(e){return I.Lightbox.close()}}(this)},this.tt("misc.lightboxes.close"))))},description_description:function(){var ref;switch((ref=this.state)!=null?ref.reason:void 0){case"broken":return"Please explain what is broken. Include how you tried to run the project, what operating system or browser you're using, and any error messages you saw. We will share your error with the creator to help them fix the issue.";case"invalid_jam_submission":return"Please explain why this submission should be disqualified or removed";case"miscategorized":return"Please explain how this project should be categorized.";default:return"Please provide a summary of your report"}},description_required:function(){var ref,ref1;return(ref=(ref1=this.state)!=null?ref1.reason:void 0)==="broken"||ref==="miscategorized"||ref==="other"||ref==="invalid_jam_submission"},email_required:function(){var ref,ref1;return(ref=(ref1=this.state)!=null?ref1.reason:void 0)==="broken"||ref==="doesnt_own"}})})}).call(this);(function(){I.libs.react.done(function(){var DayMarkers,Jam,JamCell,Jams,MonthMarkers,P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Jam");$.easing.easeInOutQuad=function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b};Jams=function(){function Jams(jams){var j,jam_data;this.jams_by_id={};this.jams=function(){var i,len,results;results=[];for(i=0,len=jams.length;i<len;i++){jam_data=jams[i];j=new Jam(jam_data);this.jams_by_id[jam_data.id]=j;results.push(j)}return results}.call(this)}Jams.prototype.truncate=function(time){return this.jams=_.reject(this.jams,function(_this){return function(jam){return jam.end_date()<time}}(this))};Jams.prototype.find_in_progress=function(){return _.filter(this.jams,function(_this){return function(jam){return jam.in_progress()}}(this))};Jams.prototype.find_in_before_start=function(){return _.filter(this.jams,function(_this){return function(jam){return jam.before_start()}}(this))};Jams.prototype.find_in_range=function(start,end){return _.filter(this.jams,function(_this){return function(jam){return jam.collides_with(start,end)}}(this))};return Jams}();Jam=function(){function Jam(data){this.data=data}Jam.prototype.length=function(){return this.end_date()-this.start_date()};Jam.prototype.collides_with=function(range_start,range_end){if(+this.start_date()>+range_end){return false}if(+this.end_date()<+range_start){return false}return true};Jam.prototype.in_progress=function(){var now;now=+new Date;return now>=+this.start_date()&&now<=+this.end_date()};Jam.prototype.before_start=function(){var now;now=+new Date;return now<+this.start_date()};Jam.prototype.after_end=function(){var now;now=+new Date;return now>+this.end_date()};Jam.prototype.start_date=function(){return this._start_date||(this._start_date=I.parse_timestamp(this.data.start_date))};Jam.prototype.end_date=function(){return this._end_date||(this._end_date=I.parse_timestamp(this.data.end_date))};Jam.prototype.voting_end_date=function(){return this._voting_end_date||(this._voting_end_date=I.parse_timestamp(this.data.voting_end_date))};return Jam}();MonthMarkers=React.memo(MonthMarkers=function(props){var curr,curr_end,end,left,markers,right;curr=dayjs(props.start_date).startOf("month");end=props.end_date;markers=[];while(curr.toDate()<end){curr_end=curr.add(1,"month");left=props.x_scale_truncated(curr.toDate());right=props.x_scale_truncated(curr_end.toDate());markers.push(div({key:"month-"+curr,className:"month_marker",style:{left:left+"px",width:right-left+"px"}},span({className:"sticky_label"},curr.format("MMMM"))));curr=curr_end}return div({className:"month_markers"},markers)});DayMarkers=React.memo(DayMarkers=function(props){var curr,curr_end,day_length,end,left,markers,right;day_length=1e3*60*60*24;curr=dayjs(props.start_date);end=+props.end_date;markers=[];while(+curr<end){curr_end=curr.add(1,"day");left=props.x_scale_truncated(curr.toDate());right=props.x_scale_truncated(curr_end.toDate());markers.push(div({key:"day-"+curr,className:"day_marker",style:{width:right-left+"px",left:left+"px"}},div({className:"day_ordinal"},curr.format("Do")),div({className:"day_name"},curr.format("ddd"))));curr=curr_end}return div({className:"day_markers"},markers)});JamCell=React.memo(JamCell=function(props){var bg_color,is_small,is_tiny,jam,text_shadow_color,width;jam=props.jam;bg_color=jam.highlight?"hsl("+jam.hue%360+", 52%, 58%)":void 0;text_shadow_color=jam.highlight?"hsl("+jam.hue%360+", 52%, 48%)":void 0;width=props.right-props.left;is_tiny=width<40;is_small=width<80;if(width<10){return null}return div({key:"jam-"+jam.id,"data-jam_id":jam.id,className:classNames("jam_cell",{is_tiny:is_tiny,is_small:is_small,after_end:props.after_end}),style:{backgroundColor:bg_color,textShadow:text_shadow_color?"1px 1px 1px "+text_shadow_color:void 0,left:props.left+"px",width:width+"px"}},span({className:"sticky_label"},a({href:jam.url,target:"_blank",title:jam.title},jam.title)," ",span({className:"joined_count"},"("+I.number_format(jam.joined||0)+" joined)")))});P("JamCalendar",{pure:true,getDefaultProps:function(){var today;today=dayjs().startOf("day");return{day_width:120,cell_height:30,start_date:today.subtract(1,"month").toDate(),end_date:today.add(2,"month").toDate()}},getInitialState:function(){return{jams:new Jams(this.props.jams)}},componentDidUpdate:function(prev_props){if(prev_props.jams!==this.props.jams){return this.setState({jams:new Jams(this.props.jams)})}},scroll_to_date:function(date){var calendar;calendar=this.calendar_ref.current;return $(calendar).animate({scrollLeft:this.x_scale(date-$(calendar).width()/2/this.x_ratio())},{duration:600,easing:"easeInOutQuad"})},move_calendar:function(dx,dy){var calendar;calendar=this.calendar_ref.current;return calendar.scrollLeft+=-dx},componentDidMount:function(){this.scroll_to_date(new Date);return $(this.calendar_scrolling_ref.current).draggable({mobile:false,skip_drag:function(_this){return function(e){if($(e.target).closest("a").length){return true}}}(this),move:function(_this){return function(dx,dy){return _this.move_calendar(dx,dy)}}(this)})},render:function(){return section({className:classNames(this.enclosing_class_name(),"calendar",{mobile_scrolling:I.is_mobile()}),ref:this.calendar_ref||(this.calendar_ref=React.createRef())},this.render_jam_rows())},render_jam_rows:function(){var jams,rows,stacked;jams=this.state.jams.find_in_range(this.props.start_date,this.props.end_date);stacked=this.stack_jams(jams);rows=stacked.map(function(_this){return function(row_jams,idx){return div({className:"calendar_row",key:"row-"+idx},row_jams.map(function(jam){var left,right;left=_this.x_scale_truncated(jam.start_date());right=_this.x_scale_truncated(jam.end_date());return React.createElement(JamCell,{key:"jam-"+jam.data.id,jam:jam.data,after_end:jam.end_date()<new Date,left:left,right:right})}))}}(this));return div({className:"calendar_scrolling",ref:this.calendar_scrolling_ref||(this.calendar_scrolling_ref=React.createRef()),style:{width:this.scrolling_width()+"px",height:40*3+6+Math.max(1,stacked.length)*(this.props.cell_height+3)+"px"}},div({className:"calendar_rows"},rows,!rows.length?div({className:"empty_message sticky_label"},"No jams match your filters"):void 0),this.render_day_markers(),this.render_month_markers(),div({className:"elapsed_time",style:{width:this.x_scale(new Date)+"px"}}))},render_month_markers:function(){return React.createElement(MonthMarkers,{start_date:this.props.start_date,end_date:this.props.end_date,x_scale_truncated:this.x_scale_truncated})},render_day_markers:function(){return React.createElement(DayMarkers,{start_date:this.props.start_date,end_date:this.props.end_date,x_scale_truncated:this.x_scale_truncated})},sort_by_length:function(jams){var days,i,jam,len,long,order,rest,short;days=1e3*60*60*24*12;short=[];long=[];rest=[];for(i=0,len=jams.length;i<len;i++){jam=jams[i];if(jam.length()<days){short.push(jam)}else{if(jam.after_end()){rest.push(jam)}else{long.push(jam)}}}short.sort(function(a,b){return a.length()-b.length()});long.sort(function(a,b){return b.length()-a.length()});order=short.concat(long).concat(rest);return order},stack_jams:function(jams){var collided,i,jam,k,l,len,len1,len2,other_jam,placed,row,rows;rows=[];this.sort_by_length(jams);for(i=0,len=jams.length;i<len;i++){jam=jams[i];placed=false;for(k=0,len1=rows.length;k<len1;k++){row=rows[k];collided=false;for(l=0,len2=row.length;l<len2;l++){other_jam=row[l];collided=jam.collides_with(other_jam.start_date(),other_jam.end_date());if(collided){break}}if(!collided){row.push(jam);placed=true;break}}if(!placed){rows.push([jam])}}return rows},scrolling_width:function(){var total_days;total_days=(this.props.end_date-this.props.start_date)/(1e3*60*60*24);return Math.floor(this.props.day_width*total_days)},x_ratio:function(){return this.scrolling_width()/(this.props.end_date-this.props.start_date)},x_scale:function(date){return Math.floor((date-+this.props.start_date)*this.x_ratio())},x_scale_truncated:function(date){return Math.min(this.scrolling_width(),Math.max(0,this.x_scale(date)))}});P("FilteredJamCalendar",{getInitialState:function(){return{min_participants:"",duration:"",featured_only:false}},get_jams:function(){var duration,jams,min_participants;jams=this.props.jams;if(this.state.min_participants&&this.state.min_participants!==""){min_participants=+this.state.min_participants;jams=jams.filter(function(j){return j.joined>=min_participants})}if(this.state.featured_only){jams=jams.filter(function(j){return j.featured})}if(this.state.duration&&this.state.duration!==""){duration=+this.state.duration;jams=jams.filter(function(j){var d;d=I.parse_timestamp(j.end_date)-I.parse_timestamp(j.start_date);if(duration<0){return d<=-1*duration*1e3*60*60*24}else{return d>=1*duration*1e3*60*60*24}})}return jams},render:function(){return section({className:this.enclosing_class_name()},div({className:"jam_calendar_filters"},div({className:"label"},"Filter")," ",R.Forms.SimpleSelect({name:"min_participants",value:this.state.min_participants,onChange:function(_this){return function(value){return _this.setState({min_participants:value})}}(this),options:[{name:"Any number",short_name:"Participants",value:""},{name:"More than 10",short_name:"Participants  10",value:"10"},{name:"More than 100",short_name:"Participants  100",value:"100"}]})," ",R.Forms.SimpleSelect({name:"duration",value:this.state.duration,onChange:function(_this){return function(value){return _this.setState({duration:value})}}(this),options:[{name:"Any duration",short_name:"Duration",value:""},{name:"Less than 3 days",short_name:" 3 days",value:"-3"},{name:"Less than 7 days",short_name:" 7 days",value:"-7"},{name:"Less than 15 days",short_name:" 15 days",value:"-15"},{name:"Greater than 15 days",short_name:" 15 days",value:"15"}]})," ",label({},input({type:"checkbox",checked:this.state.featured_only,onChange:function(_this){return function(e){return _this.setState({featured_only:e.target.checked})}}(this)})," ",span({className:"label",title:"Top picks from the itch.io team"},"Featured"))),R.Jam.JamCalendar({jams:this.get_jams()}))}})})}).call(this);(function(){I.libs.react.done(function(){var Browse,P,PAGE_SIZE,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Jam");PAGE_SIZE=45;Browse=R["package"]("Browse");I.karma_score=function(jam_game){var coolness,ratings;coolness=jam_game.coolness||0;ratings=jam_game.rating_count||0;return Math.log(1+coolness)-Math.log(1+ratings)/Math.log(5)};types=PropTypes;R.Icons.Sort=function(props){var height,ref,ref1,width;width=(ref=props.width)!=null?ref:24;height=(ref1=props.height)!=null?ref1:width;return React.createElement("svg",{className:"svgicon icon_sort",role:"img",version:"1.1",viewBox:"0 0 455 488",width:width,height:height,"aria-hidden":true,fill:"currentColor"},React.createElement("path",{d:"M304 392v48c0 4.5-3.5 8-8 8h-64c-4.5 0-8-3.5-8-8v-48c0-4.5 3.5-8 8-8h64c4.5 0 8 3.5 8 8zM184 360c0 2.25-1 4.25-2.5 6l-79.75 79.75c-1.75 1.5-3.75 2.25-5.75 2.25s-4-0.75-5.75-2.25l-80-80c-2.25-2.5-3-5.75-1.75-8.75s4.25-5 7.5-5h48v-344c0-4.5 3.5-8 8-8h48c4.5 0 8 3.5 8 8v344h48c4.5 0 8 3.5 8 8zM352 264v48c0 4.5-3.5 8-8 8h-112c-4.5 0-8-3.5-8-8v-48c0-4.5 3.5-8 8-8h112c4.5 0 8 3.5 8 8zM400 136v48c0 4.5-3.5 8-8 8h-160c-4.5 0-8-3.5-8-8v-48c0-4.5 3.5-8 8-8h160c4.5 0 8 3.5 8 8zM448 8v48c0 4.5-3.5 8-8 8h-208c-4.5 0-8-3.5-8-8v-48c0-4.5 3.5-8 8-8h208c4.5 0 8 3.5 8 8z"}))};Browse("FilterGroup",{pure:true,propTypes:{label:types.string.isRequired,active:types.bool,default_filters_open:types.bool,filters:types.array.isRequired,on_pick_filter:types.func,on_clear_group:types.func,on_clear_filter:types.func},getInitialState:function(){var ref;return{filters_open:(ref=this.props.default_filters_open)!=null?ref:true}},toggle_open:function(e){return this.setState(function(state){return{filters_open:!state.filters_open}})},render:function(){var filter,group_active,i,len,number_active,ref,ref1,ref2;number_active=0;ref=this.props.filters;for(i=0,len=ref.length;i<len;i++){filter=ref[i];if(filter.active){number_active+=1}}group_active=(ref1=this.props.active)!=null?ref1:number_active>0;return this.enclose({className:classNames("browse_filter_group_widget",{active:group_active,filters_open:this.state.filters_open})},div({className:"filter_group_label"},button({onClick:this.toggle_open,className:"group_toggle_btn",type:"button"},span({className:"filter_arrow"},span({className:"icon icon-triangle-down"}),span({className:"icon icon-triangle-right"}))," ",this.props.label),group_active&&number_active===1&&((ref2=this.props.show_group_clear)!=null?ref2:true)?button({className:"filter_clear",title:this.t("browse.filter_group.clear_filter"),onClick:function(_this){return function(e){var base;if(_this.props.on_clear_group){return _this.props.on_clear_group()}else if(number_active===1){return typeof(base=_this.props).on_clear_filter==="function"?base.on_clear_filter(_this.props.filters.find(function(f){return f.active})):void 0}}}(this)},R.Icons.Close({width:16,stroke_width:3})):void 0),ul({},this.props.filters.map(function(_this){return function(filter,idx){return li({key:filter.id?"filter-"+filter.id:idx,title:filter.tooltip,className:classNames({active:filter.active})},button({type:"button",style:filter.style,onClick:function(e){var base;return typeof(base=_this.props).on_pick_filter==="function"?base.on_pick_filter(filter):void 0}},filter.label),filter.active&&number_active>1?div({},button({type:"button",title:"Clear filter",className:"filter_clear",onClick:function(e){var base;return typeof(base=_this.props).on_clear_filter==="function"?base.on_clear_filter(filter):void 0}},R.Icons.Close({width:16,stroke_width:3}))):void 0)}}(this))),this.props.default_filters_open===false&&number_active>0?button({className:"toggle_more_btn",onClick:this.toggle_open,"data-more_label":this.t("browse.filter_group.more_options"),"data-fewer_label":this.t("browse.filter_group.fewer_options")},this.tt("browse.filter_group.toggle_more_options")):void 0)}});P("LoadOnScroll",{componentWillUnmount:function(){return typeof this.unbind_visibility==="function"?this.unbind_visibility():void 0},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_visibility=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var ref;return(ref=_this.props)!=null?ref.on_seen():void 0}}(this)})},render:function(){return this.props.children}});P("EntriesFilters",{pure:true,getInitialState:function(){return{}},getDefaultProps:function(){return{filters:{}}},render_search:function(){var ref;if(!this.props.show_search){return}if((((ref=this.props.filter_counts)!=null?ref.total:void 0)||0)<2){return}this.search_debounced||(this.search_debounced=_.throttle(function(_this){return function(query){return _this.props.set_filter("search",query)}}(this),300,{leading:false}));return section({className:"search"},input({type:"text",className:"search_input",placeholder:"Search by title or author",required:true,onChange:function(_this){return function(e){return _this.search_debounced($.trim(e.target.value))}}(this)}))},render_rated_filter:function(){var filters,ref,ref1;filters=[];if((ref=this.props.filter_counts)!=null?ref.user_ratings:void 0){filters.push({label:"Haven't rated ("+I.number_format(this.props.filter_counts.user_missing_ratings||0)+")",value:"havent_rated",active:this.props.filters.rated===false});filters.push({label:"Have rated ("+I.number_format(this.props.filter_counts.user_ratings||0)+")",value:"have_rated",active:this.props.filters.rated===true})}if(((ref1=this.props.filter_counts)!=null?ref1.submitted_games:void 0)>0){filters.push({active:this.props.filters.own_submissions,value:"own_submissions",label:"My submissions ("+I.number_format(this.props.filter_counts.submitted_games)+")"})}if(!filters.length){return}return Browse.FilterGroup({label:"Submissions",filters:filters,on_pick_filter:function(_this){return function(filter){switch(filter.value){case"have_rated":case"havent_rated":return _this.props.set_filter({own_submissions:"",rated:filter.value==="have_rated"});case"own_submissions":return _this.props.set_filter({own_submissions:true,rated:""})}}}(this),on_clear_filter:function(_this){return function(filter){switch(filter.value){case"have_rated":case"havent_rated":return _this.props.set_filter("rated","");case"own_submissions":return _this.props.set_filter("own_submissions","")}}}(this)})},render_platform_filter:function(){var count,filters,push,ref,ref1,ref2,ref3,ref4;filters=[];push=function(_this){return function(value,label){return filters.push({label:label,value:value,active:_this.props.filters.platform===value})}}(this);if(count=(ref=this.props.filter_counts)!=null?ref.web:void 0){push("web",fragment({},span({className:"icon icon-globe"}),"Play in browser ("+I.number_format(count)+")"))}if(count=(ref1=this.props.filter_counts)!=null?ref1.windows:void 0){push("windows",fragment({},span({className:"icon icon-windows8"}),"Windows ("+I.number_format(count)+")"))}if(count=(ref2=this.props.filter_counts)!=null?ref2.osx:void 0){push("osx",fragment({},span({className:"icon icon-apple"}),"macOS ("+I.number_format(count)+")"))}if(count=(ref3=this.props.filter_counts)!=null?ref3.linux:void 0){push("linux",fragment({},span({className:"icon icon-tux"}),"Linux ("+I.number_format(count)+")"))}if(count=(ref4=this.props.filter_counts)!=null?ref4.android:void 0){push("android",fragment({},span({className:"icon icon-android"}),"Android ("+I.number_format(count)+")"))}if(!filters.length){return null}return Browse.FilterGroup({label:this.tt("browse.filter_group_platform"),filters:filters,on_pick_filter:function(_this){return function(filter){return _this.props.set_filter("platform",filter.value)}}(this),on_clear_filter:function(_this){return function(filter){return _this.props.set_filter("platform","")}}(this)})},render_sorts:function(){var current_sort,filters,push,ref,ref1,ref2,ref3;if((((ref=this.props.filter_counts)!=null?ref.total:void 0)||0)<2){return}current_sort=(ref1=this.props.sort)!=null?ref1:"";filters=[];push=function(label,value){return filters.push({label:fragment({},R.Icons.Sort({width:18}),label),value:value,active:current_sort===value})};push(this.tt("browse.sort_popular"),"");push("Random","random");if((ref2=this.props.filter_counts)!=null?ref2.total_coolness:void 0){push("Most Karma","most_karma")}if((ref3=this.props.filter_counts)!=null?ref3.total_ratings:void 0){push("Least rated","least_ratings");push("Most rated","most_ratings")}push("Submission order","created_at_asc");push("Most recently submitted","created_at_desc");return Browse.FilterGroup({label:this.tt("browse.sort"),default_filters_open:false,show_group_clear:current_sort!=="",filters:filters,on_pick_filter:function(_this){return function(filter){return _this.props.set_sort(filter.value)}}(this),on_clear_filter:function(_this){return function(filter){return _this.props.set_sort("")}}(this)})},render_fields:function(){if(!this.props.fields){return}return this.props.fields.map(function(_this){return function(field,idx){var count,field_key,filters,i,len,ref,ref1;field_key="field:"+field.id;filters=[];ref=field.options;for(i=0,len=ref.length;i<len;i++){option=ref[i];count=(ref1=_this.props.filter_counts)!=null?ref1[field_key+":"+option.id]:void 0;if(!count){continue}filters.push({key:field_key,label:option.name+" ("+I.number_format(count)+")",tooltip:option.description?option.name+" "+option.description:option.name,value:option.id,active:_this.props.filters[field_key]===option.id})}if(!filters.length){return}return Browse.FilterGroup({key:field.id?"field-"+field.id:"idx-"+idx,label:field.name,filters:filters,on_pick_filter:function(filter){return _this.props.set_filter(filter.key,filter.value)},on_clear_filter:function(filter){return _this.props.set_filter(filter.key,"")}})}}(this))},render:function(){return this.enclose({component:"section",className:"filter_pickers"},this.render_search(),this.render_rated_filter(),this.render_platform_filter(),this.render_fields(),this.render_sorts())}});P("BrowseEntries",{getInitialState:function(){return{loading:true,sort:this.props.default_sort,filter_counts:this.props.jam_games?this.summarize_results(this.props.jam_games):void 0}},componentDidMount:function(){if(this.props.total_entries_count&&this.props.jam_games){if(this.props.total_entries_count===this.props.jam_games.length){this.setState({page_number:1,jam_games:this.props.jam_games},function(_this){return function(){_this.refresh_random_order();return _this.setState(Object.assign({loading:false},_this.filter_results(_this.state.jam_games)))}}(this));return}}return this.refresh_games()},refresh_games:function(){this.setState({loading:true});return $.get(this.props.entries_url).done(function(_this){return function(res){if(res.errors){_this.setState({loading:false,errors:res.errors});return}return _this.setState({page_number:1,jam_games:_.toArray(res.jam_games),generated_on:res.generated_on,fetched_on:+new Date/1e3},function(){_this.refresh_random_order();return _this.setState(Object.assign({loading:false},_this.filter_results(_this.state.jam_games)))})}}(this)).fail(function(_this){return function(xhr){var errors,ref;errors=((ref=xhr.responseJSON)!=null?ref.errors:void 0)||["There was an error fetching the entries ("+xhr.status+")"];return _this.setState({loading:false,errors:errors})}}(this))},set_filter:function(name,value){return this.setState(function(_this){return function(state){var filters,k,u,update,v;filters=Object.assign({},state.filters);update=typeof name==="string"?(u={},u[name]=value,u):name;for(k in update){if(!hasProp.call(update,k))continue;v=update[k];if(v===""){delete filters[k]}else{filters[k]=v}}return{filters:filters,page_number:1}}}(this),function(_this){return function(){if(!_this.state.jam_games){return}return _this.setState(_this.filter_results(_this.state.jam_games))}}(this))},refresh_random_order:function(){var i,item,len,ref,results1;if(!this.state.jam_games){return}ref=this.state.jam_games;results1=[];for(i=0,len=ref.length;i<len;i++){item=ref[i];results1.push(item.r=Math.random())}return results1},set_sort:function(type){this.refresh_random_order();return this.setState({sort:type,page_number:1},function(_this){return function(){return _this.setState(_this.filter_results(_this.state.jam_games))}}(this))},transform_query:function(q){var parts;q=q.replace(/[:^~]/g," ");parts=q.match(/[^\s]+/g).map(function(_this){return function(chunk){if(chunk.match(/[*]$/)||chunk.match(/^[-+*]/)){return chunk}else{return chunk+"^2 "+chunk+"*"}}}(this));return parts.join(" ")},filter_results:function(jam_games){var filtered_by_id,filtered_results,filters,has_more,jg,num_items,page_results,r,search_query,search_results,search_results_by_id,sorted_results,summary;num_items=this.state.page_number*PAGE_SIZE;summary=this.summarize_results(jam_games);search_results=false;search_results_by_id=false;filtered_results=function(){var i,len;if(filters=this.state.filters){search_query=this.state.filters.search;if(search_query){search_query=this.transform_query(search_query);if(this.state.search_index){search_results=this.state.search_index.search(search_query);search_results_by_id={};for(i=0,len=search_results.length;i<len;i++){r=search_results[i];search_results_by_id[r.ref]=true}}else{this.get_search_index().then(function(_this){return function(){if(_this.state.filters===filters){return _this.set_filter("search",filters.search)}}}(this))}}return jam_games.filter(function(_this){return function(jg){var k,m,rated,ref,ref1,ref2,response,v;if(search_results_by_id){if(!search_results_by_id[jg.game.id]){return false}}ref=_this.state.filters;for(k in ref){if(!hasProp.call(ref,k))continue;v=ref[k];switch(k){case"platform":if(!(jg.game.platforms&&indexOf.call(jg.game.platforms,v)>=0)){return false}break;case"rated":rated=(ref1=_this.props.rated_games)!=null?ref1[jg.game.id]:void 0;if(v===true){if(!rated){return false}}else if(v===false){if(rated){return false}}break;case"own_submissions":if(v){if(!((ref2=_this.props.submitted_games)!=null?ref2[jg.game.id]:void 0)){return false}}break;default:if(m=k.match(/^field:(\d+)/)){response=m[1]+":"+v;if(!(jg.field_responses&&indexOf.call(jg.field_responses,response)>=0)){return false}}}}return true}}(this))}else{return jam_games}}.call(this);sorted_results=function(){var i,j,len,len1,results1;if(search_results){filtered_by_id={};for(i=0,len=filtered_results.length;i<len;i++){jg=filtered_results[i];filtered_by_id[jg.game.id]=jg}results1=[];for(j=0,len1=search_results.length;j<len1;j++){r=search_results[j];jg=filtered_by_id[r.ref];if(!jg){continue}results1.push(jg)}return results1}else{switch(this.state.sort){case"random":return filtered_results.slice().sort(function(a,b){return a.r-b.r});case"most_karma":return filtered_results.slice().sort(function(a,b){var a_karma,b_karma;a_karma=I.karma_score(a);b_karma=I.karma_score(b);return b_karma-a_karma});case"least_ratings":return filtered_results.slice().sort(function(a,b){return(a.rating_count||0)-(b.rating_count||0)});case"most_ratings":return filtered_results.slice().sort(function(a,b){return(b.rating_count||0)-(a.rating_count||0)});case"created_at_desc":return filtered_results.slice().sort(function(a,b){return b.id-a.id});case"created_at_asc":return filtered_results.slice().sort(function(a,b){return a.id-b.id});default:return filtered_results}}}.call(this);page_results=sorted_results.slice(0,num_items);has_more=page_results.length<sorted_results.length;return{visible_jam_games:page_results,filter_counts:summary,has_more:has_more}},summarize_results:function(results){var i,j,key,len,len1,len2,n,out,plat,r,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,response;out={total:0};for(i=0,len=results.length;i<len;i++){r=results[i];if(r.rating_count){out.total_ratings=out.total_ratings||0+r.rating_count}if(r.coolness){out.total_coolness=out.total_coolness||0+r.coolness}out.total+=1;if((ref=r.game)!=null?(ref1=ref.platforms)!=null?ref1.length:void 0:void 0){ref2=r.game.platforms;for(j=0,len1=ref2.length;j<len1;j++){plat=ref2[j];out[plat]=(out[plat]||0)+1}}if((ref3=this.props.rated_games)!=null?ref3[(ref4=r.game)!=null?ref4.id:void 0]:void 0){out.user_ratings=(out.user_ratings||0)+1}else{out.user_missing_ratings=(out.user_missing_ratings||0)+1}if((ref5=this.props.submitted_games)!=null?ref5[(ref6=r.game)!=null?ref6.id:void 0]:void 0){out.submitted_games=(out.submitted_games||0)+1}if(r.field_responses){ref7=r.field_responses;for(n=0,len2=ref7.length;n<len2;n++){response=ref7[n];key="field:"+response;out[key]=(out[key]||0)+1}}}return out},show_next_page:function(){return this.setState(function(_this){return function(s){return{page_number:s.page_number+1}}}(this),function(_this){return function(){return _this.setState(_this.filter_results(_this.state.jam_games))}}(this))},build_game_object:function(jam_game){return Object.assign({},jam_game.game,{url:jam_game.url,contributors:jam_game.contributors,jam_game:jam_game})},get_search_index:function(){if(!this.state.jam_games){return}return this.lunr_deferred||(this.lunr_deferred=$.Deferred(function(_this){return function(d){var js;js=document.createElement("script");js.type="text/javascript";js.src=_this.props.lunr_js_url;document.body.appendChild(js);return I.wait_for_object(window,"lunr",function(){var index,jam_games;jam_games=_this.state.jam_games;index=lunr(function(){var authors,flat_title,game,i,jg,len,results1;this.ref("id");this.field("title",{boost:2});this.field("flat_title");this.field("authors");results1=[];for(i=0,len=jam_games.length;i<len;i++){jg=jam_games[i];game=jg.game;flat_title=game.title.replace(/\s+/,"");if(flat_title===game.title){flat_title=null}authors=jg.contributors?jg.contributors.map(function(_this){return function(c){return c.name}}(this)):game.user.name;results1.push(this.add({id:game.id,title:game.title,flat_title:flat_title,authors:authors}))}return results1});return _this.setState({search_index:index},function(){return d.resolve(index)})})}}(this)))},render_unrated_nag:function(){if(!this.props.jam.during_voting){return}if(this.props.jam.score_upvote){return}if(!this.props.allowed_to_rate){return}if(this.props.rate_queue_required){return p({className:"rating_message"},"This jam requires your to rate entries at random. ",a({href:this.props.unrated_entries_url,className:"forward_link"},"View your queue"))}else{return p({className:"rating_message"},this.tt("jam.submissions.help_submissions_in_need_of_ratings",{a:function(_this){return function(l){return a({href:_this.props.unrated_entries_url},l)}}(this)}))}},render:function(){return this.enclose({className:classNames("browse_columns",{sidebar_open:this.state.sidebar_open})},div({className:"browse_sidebar",tabIndex:-1,ref:this.sidebar_ref||(this.sidebar_ref=React.createRef())},this.render_sidebar()),div({className:"primary_column",onClick:this.state.sidebar_open?function(_this){return function(e){_this.setState({sidebar_open:false});return e.preventDefault()}}(this):void 0},this.render_primary_column()))},render_sidebar:function(){var ref;return div({className:"sticky_wrapper"},section({},h2({},"Filter Submissions")),P.EntriesFilters({show_search:true,filter_counts:this.state.filter_counts,set_sort:this.set_sort,set_filter:this.set_filter,fields:this.props.fields,randomizer_url:this.props.randomizer_url,unrated_entries_url:this.props.unrated_entries_url,rate_queue_required:this.props.rate_queue_required,filters:this.state.filters,sort:(ref=this.state.sort)!=null?ref:this.props.default_sort}),this.props.rate_queue_required?section({className:"filter_pickers sidebar_buttons"},a({href:this.props.unrated_entries_url,className:"button outline randomizer_link"},span({className:"icon icon-shuffle"})," ","View my queue")):this.props.randomizer_url?section({className:"filter_pickers sidebar_buttons"},a({href:this.props.randomizer_url,className:"button outline randomizer_link"},span({className:"icon icon-shuffle"})," ","View random submission")):void 0)},render_primary_column:function(){var ref;return fragment({},div({className:"filter_toggle_row"},button({type:"button",onClick:function(_this){return function(e){return _this.setState({sidebar_open:true},function(){var ref;return(ref=_this.sidebar_ref.current)!=null?ref.focus():void 0})}}(this)},R.Icons.Filter,"Filter Results"),this.props.total_entries_count?span({className:"entries_count"},this.props.total_entries_count+" total entries"):void 0),this.render_unrated_nag(),this.props.show_cache_age&&this.state.fetched_on-this.state.generated_on>1?div({className:"cache_message"},span({className:"icon icon-warning"})," ","Some data on this page is cached, was last updated "+I.format_timestamp(this.state.generated_on*1e3)):void 0,this.state.errors?R.Forms.FormErrors({title:"There was an issue with your request",errors:this.state.errors}):this.state.loading?this.props.jam_games?this.render_preview_grid():div({className:"loading_container"},div({className:"loader_spinner"})):this.state.visible_jam_games?this.state.page_number===1&&!((ref=this.state.visible_jam_games)!=null?ref.length:void 0)?div({className:"empty_content"},this.state.filters?this.tt("jam.submissions.empty_results"):this.props.jam.submissions_upcoming?this.tt("jam.submissions.there_are_no_submissions_yet"):this.tt("jam.submissions.there_were_no_submissions")):fragment({},R.Index.GameGrid({ref:this.game_grid_ref||(this.game_grid_ref=React.createRef()),games:this.state.visible_jam_games,build_game_object:this.build_game_object,conversion_source:this.props.conversion_source,cell_props:this.grid_cell_props||(this.grid_cell_props={render_cell_below:function(_this){return function(game){var jg;if(_this.props.show_cache_age){if(jg=game.jam_game){return fragment({},div({},"Ratings: "+jg.rating_count),div({},"Coolness: "+jg.coolness),div({},": "+(jg.coolness-jg.rating_count)),div({},"K: "+I.karma_score(jg)))}}}}(this),render_thumb_extras:function(_this){return function(game){var ref1;if((ref1=_this.props.rated_games)!=null?ref1[game.id]:void 0){return div({className:"rated_game"},div({className:"rated_label"},span({className:"icon icon-checkmark"})," ",_this.tt("jam.submissions.rated")))}}}(this),target:"_blank"}),grid_sizer_props:this.grid_sizer_props||(this.grid_sizer_props={on_reshape:function(_this){return function(){if(!_this.state.grid_ready){return _this.setState({grid_ready:true})}}}(this)})}),this.state.has_more&&this.state.grid_ready?P.LoadOnScroll({key:[this.state.page_number,JSON.stringify(this.state.filters||{},Object.keys(this.state.filters||{}).sort()),this.state.sort].join("-"),on_seen:this.show_next_page},div({className:"loading_container"},div({className:"loader_spinner"}))):void 0):void 0)},render_preview_grid:function(){return div({className:"index_game_grid_widget layout_grid preview_grid"},this.props.jam_games.map(function(_this){return function(jam_game){var game;game=jam_game.game;return div({className:"game_cell index_game_cell_widget",key:game.id},div({className:"bordered"}),div({className:"label"},a({className:"title",href:game.url},game.title)),div({className:"user_row"},a({className:"user_link",href:game.user.url},game.user.name)))}}(this)))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,_uid,a,br,button,code,div,em,fieldset,form,fragment,get_uid,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,table,tbody,td,textarea,thead,tr,ul,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},hasProp={}.hasOwnProperty;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Jam");table=ReactDOMFactories.table,thead=ReactDOMFactories.thead,tbody=ReactDOMFactories.tbody,tr=ReactDOMFactories.tr,td=ReactDOMFactories.td;_uid=0;get_uid=function(){return""+_uid++};P("JamGameVoter",{getInitialState:function(){var crit,i,len,ref,ref1,stored_criteria_values;stored_criteria_values={};ref=this.props.criteria;for(i=0,len=ref.length;i<len;i++){crit=ref[i];stored_criteria_values[crit.id]=(ref1=crit.existing_rating)!=null?ref1.score:void 0}return{uid:this.enclosing_class_name()+"-"+get_uid(),criteria_values:stored_criteria_values,show_recaptcha:this.props.show_recaptcha,stored_criteria_values:stored_criteria_values}},componentDidMount:function(){return $(window).on("beforeunload",this.send_dirty_warning)},componentWillUnmount:function(){return $(window).off("beforeunload",this.send_dirty_warning)},send_dirty_warning:function(){if(this.is_dirty()){return"You have unsaved changes"}},remote_submit:function(e){if(this.state.loading){return}e.preventDefault();this.setState({loading:true,errors:null,flash:false});return I.remote_submit($(this.form_ref.current)).then(function(_this){return function(res){_this.setState({loading:false});if(res.errors){if(indexOf.call(res.errors,"recaptcha")>=0){_this.setState({show_recaptcha:true})}_this.setState({errors:res.errors});return}if(res.flash){_this.setState({flash:res.flash})}if(res.success){return _this.setState({show_recaptcha:false,stored_criteria_values:_this.state.criteria_values})}}}(this))},is_completed:function(){var crit,i,len,ref;if(this.props.type_upvote){return true}ref=this.props.criteria;for(i=0,len=ref.length;i<len;i++){crit=ref[i];if(this.state.criteria_values[crit.id]==null){return false}}return true},is_dirty:function(){var crit_id,ref,stored_value,value;ref=this.state.stored_criteria_values;for(crit_id in ref){if(!hasProp.call(ref,crit_id))continue;stored_value=ref[crit_id];value=this.state.criteria_values[crit_id];if(value!=null&&stored_value!==value){return true}}return false},render:function(){var is_completed;return div({className:classNames(this.enclosing_class_name(),"criteria_rater")},form({ref:this.form_ref||(this.form_ref=React.createRef()),onSubmit:this.remote_submit,method:"post"},R.CSRF({}),this.props.rating_token?input({type:"hidden",name:"rating_token",value:this.props.rating_token}):void 0,input({type:"hidden",name:"json",value:"1"}),input({type:"hidden",name:"action",value:"rate"}),this.render_criteria_table(),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,animated:true}):void 0,this.state.show_recaptcha?R.Forms.RecaptchaInput({sitekey:this.props.recaptcha_sitekey}):void 0,is_completed=this.is_completed(),div({className:"buttons_row"},button({className:classNames("button rate_btn",{disabled:!is_completed}),disabled:!is_completed},this.props.type_upvote?this.tt("jam.submission.rate_submission.save_vote"):this.tt("jam.submission.rate_submission.save_rating"))," ",this.state.flash?span({className:"form_flash","aria-live":"polite"},this.state.flash):!is_completed?span({className:"form_flash"},"Vote on all criteria to save your rating"):this.is_dirty()?span({className:"form_flash"},strong({},"You have unsaved changes!")):void 0)))},render_criteria_table:function(){return table({className:"criteria_wrap"},tbody({},this.props.criteria.map(function(_this){return function(crit){var input_name,label_id,ref,ref1,ref2;input_name="ratings["+crit.name+"]";label_id=_this.state.uid+"-"+crit.id+"-label";return tr({className:"criteria_row",key:crit.id},td({className:"crit_label",id:label_id},crit.name),td({},_this.props.type_upvote?label({className:"criteria_upvote"},input({type:"checkbox",name:input_name,defaultChecked:((ref=(ref1=crit.existing_rating)!=null?ref1.score:void 0)!=null?ref:0)>0,onChange:function(e){var update;update={};update[crit.id]=e.target.checked;return _this.setState(function(s){return{flash:false,criteria_values:Object.assign({},s.criteria_values,update)}})}})," ",strong({},_this.tt("jam.submission.rate_submission.vote"))):R.Forms.StarPicker({className:"star_picker",name:input_name,"aria-labelledby":label_id,"aria-describedby":label_id,defaultValue:(ref2=crit.existing_rating)!=null?ref2.score:void 0,on_change:function(value){var update;update={};update[crit.id]=value;return _this.setState(function(s){return{flash:false,criteria_values:Object.assign({},s.criteria_values,update)}})}})))}}(this))))}})})}).call(this);(function(){var calculate_offset,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;if(typeof I!=="undefined"&&I!==null?I.Grapher:void 0){return}calculate_offset=function(el,parent){var offset_parent,ox,oy,ref,ref1,x,y;ref=el.offset(),x=ref.left,y=ref.top;offset_parent=parent.offsetParent();if(!offset_parent.is("html")){ref1=offset_parent.offset(),ox=ref1.left,oy=ref1.top;x-=ox;y-=oy}return[Math.floor(x),Math.floor(y)]};I.Grapher=function(){Grapher.format_number=I.format_integer;Grapher.prototype.chart_svg_class="chart";Grapher.prototype.margin_left=40;Grapher.prototype.margin_bottom=30;Grapher.prototype.margin_right=30;Grapher.prototype.margin_top=20;Grapher.prototype.dot_hitbox_w=30;Grapher.prototype.dot_hitbox_h=120;Grapher.prototype.axis_spacing=8;Grapher.prototype.axis_graph_padding=10;Grapher.prototype.popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';Grapher.prototype.default_opts={label:"Count",y_axis_padding:1.3,min_y:10,x_ticks:10,fit_dots:false};function Grapher(el,data1,opts){var ref,ref1,ref2,ref3;this.data=data1;this.increment_date=bind(this.increment_date,this);this.list_range=bind(this.list_range,this);this.get_range=bind(this.get_range,this);this.format_y_axis=bind(this.format_y_axis,this);this.get_y_scaled=bind(this.get_y_scaled,this);this.get_x_scaled=bind(this.get_x_scaled,this);this.get_y=bind(this.get_y,this);this.get_x=bind(this.get_x,this);this.popup_date=bind(this.popup_date,this);this.axis_offsets=bind(this.axis_offsets,this);if(!this.data){this.data=opts.graph_counts}if(!this.data){throw"No data for graph"}this.el=$(el);this.opts=$.extend({},this.default_opts,opts);this.margin_left=(ref=this.opts.margin_left)!=null?ref:this.margin_left;this.margin_bottom=(ref1=this.opts.margin_bottom)!=null?ref1:this.margin_bottom;this.margin_top=(ref2=this.opts.margin_top)!=null?ref2:this.margin_top;this.margin_right=(ref3=this.opts.margin_right)!=null?ref3:this.margin_right;this.draw();this.setup_popups()}Grapher.prototype.popup_position=function(hitbox){return calculate_offset(hitbox.prev("circle"),this.el)};Grapher.prototype.get_template=function(name){var base;if(name==null){name="poup_template"}this._templates||(this._templates={});(base=this._templates)[name]||(base[name]=_.template(this[name]));return this._templates[name]};Grapher.prototype.setup_popups=function(){var current_popup,el,remove_popup,toggle_popup;current_popup=null;remove_popup=function(popup){if(!popup){return}return popup.stop(true,true).remove()};toggle_popup=_.debounce(function(_this){return function(state,hitbox){var h,pad,popup,ref,template,w,x,y;hitbox=$(hitbox);if(!hitbox.data("popup")){return}switch(state){case"show":template=_this.get_template(hitbox.data("popup_template")||"popup_template");popup=hitbox.data("popup_el");if(current_popup!=null?current_popup.is(popup):void 0){return}remove_popup(current_popup);if(!popup){popup=$(template(hitbox.data("popup")));hitbox.data("popup_el",popup)}current_popup=popup;current_popup.appendTo(_this.el).hide().fadeIn("fast");ref=_this.popup_position(hitbox),x=ref[0],y=ref[1];pad=5;w=current_popup.outerWidth();h=current_popup.outerHeight();current_popup.css({left:x-w-pad+"px",top:y-h-pad+"px"});return typeof _this.on_show_popup==="function"?_this.on_show_popup(current_popup,hitbox):void 0;case"hide":remove_popup(current_popup);if(typeof _this.on_hide_popup==="function"){_this.on_hide_popup(current_popup,hitbox)}return current_popup=null}}}(this),30);el=this.svg.node();el.addEventListener("mouseover",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("show",e.target)}}}(this));return el.addEventListener("mouseout",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("hide",e.target)}}}(this))};Grapher.prototype.draw=function(){var cls,data,ref,ref1,ref2,ref3,ref4,target_height,target_width,x,y;target_width=(ref=this.opts.width)!=null?ref:this.el.width();target_height=(ref1=this.opts.height)!=null?ref1:this.el.height();this.w=target_width/((ref2=this.opts.scale)!=null?ref2:1);this.h=target_height/((ref3=this.opts.scale)!=null?ref3:1);this.time_format=d3.time.format("%Y-%m-%d");cls=this.chart_svg_class;if(this.opts["class"]){cls+=" "+this.opts["class"]}this.svg=d3.select(this.el[0]).append("svg").attr("class",cls).attr("width",(ref4=this.opts.width)!=null?ref4:"100%").attr("height",target_height).attr("viewBox","0 0 "+this.w+" "+this.h);data=this.format_data();x=this._x_scale=this.x_scale(data);y=this._y_scale=this.y_scale(data);this.draw_guides(x,y);this.draw_area(data);this.draw_axis(x,y);this.draw_dots(data);return this.draw_label()};Grapher.prototype.guide_x_range=function(x,y){return x.range()};Grapher.prototype.draw_guides=function(x,y){var gx,gy,ref,y_guides;y_guides=this.svg.append("g").attr("class","y_guides");ref=this.guide_x_range(x,y),gx=ref[0],gy=ref[1];y_guides.selectAll("line").data(y.ticks(this.y_ticks())).enter().append("line").attr("x1",gx).attr("y1",y).attr("x2",gy).attr("y2",y);if(x.ticks){return this.svg.append("g").attr("class","x_guides").selectAll("line").data(x.ticks(this.x_ticks())).enter().append("line").attr("x1",x).attr("y1",y.range()[0]).attr("x2",x).attr("y2",y.range()[1])}};Grapher.prototype.axis_offsets=function(){return[0,0]};Grapher.prototype.draw_axis=function(x,y){var left,ox,oy,ref,x_axis,y_axis;y_axis=d3.svg.axis().scale(y).orient("left").tickFormat(this.format_y_axis).ticks(this.y_ticks());left=x.domain()[0];ref=this.axis_offsets(),ox=ref[0],oy=ref[1];this.svg.append("g").attr("transform","translate("+(this._x_scale(left)+ox-this.axis_spacing)+", 0)").attr("class","y_axis axis").call(y_axis);x_axis=d3.svg.axis().scale(x).orient("bottom").ticks(this.x_ticks());return this.svg.append("g").attr("transform","translate(0, "+(y.range()[0]+oy+this.axis_spacing)+")").attr("class","x_axis axis").call(x_axis)};Grapher.prototype.draw_area=function(data){var area,line_style;line_style=this.opts.line_style||"area";area=function(){switch(line_style){case"area":return d3.svg.area().x(this.get_x_scaled).y1(this.get_y_scaled).y0(this.h-this.margin_bottom);case"line":return d3.svg.line().x(this.get_x_scaled).y(this.get_y_scaled);default:throw"Unknown line style: "+line_style}}.call(this);return this.svg.append("g").attr("class","graph").append("path").attr("class",line_style).attr("d",area(data))};Grapher.prototype.draw_label=function(){var label;label=this.svg.append("g").attr("class","label").attr("transform","translate("+this.margin_left+", 10)");label.append("circle").attr("cx",0).attr("cy",-5).attr("r",4);return label.append("text").text(this.opts.label).attr("x",10)};Grapher.prototype.draw_dots=function(data,opts){var hitbox_h,hitbox_w,popups,ref;if(opts==null){opts={}}if(this.opts.show_dots===false){return}data=this.filter_dots_data(data);if(this.list_range().length>((ref=this.opts.max_dots)!=null?ref:60)){return}popups=this.svg.append("g").attr("class","popups").selectAll("g").data(data).enter().append("g").attr("class","popup_trigger");hitbox_w=this.dot_hitbox_w;hitbox_h=this.dot_hitbox_h;popups.append("circle").attr("class","dot_outline").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",6);popups.append("circle").attr("class","dot").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",4);return popups.append("rect").attr("class",function(_this){return function(d){var base,c;c="column_dot hitbox";if(typeof(base=_this.opts).column_url==="function"?base.column_url(d):void 0){c+=" link"}return c}}(this)).attr("transform","translate(-"+hitbox_w/2+", -"+hitbox_h/2+")").attr("x",this.get_x_scaled).attr("y",this.get_y_scaled).attr("width",hitbox_w).attr("height",hitbox_h).attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.popup_label.apply(_this,arguments)})}}(this))};Grapher.prototype.filter_dots_data=function(data){var can_fit,dots_to_fit,i,real_w,subset,take_every;if(this.opts.fit_dots){real_w=this.w-this.margin_left-this.margin_right-this.axis_graph_padding;can_fit=Math.floor(real_w/this.dot_hitbox_w);if(data.length>can_fit){dots_to_fit=Math.floor((real_w-this.dot_hitbox_w*2)/this.dot_hitbox_w);take_every=Math.floor((data.length-2)/dots_to_fit);subset=function(){var j,ref,ref1,results;results=[];for(i=j=1,ref=data.length-2,ref1=take_every;ref1>0?j<=ref:j>=ref;i=j+=ref1){results.push(data[i])}return results}();subset.push(data[data.length-1]);subset.unshift(data[1]);return subset}}return data};Grapher.prototype.popup_label=function(d){var val;val=this.opts.rate?I.number_format(this.get_y(d),4)+"%":I.number_format(this.get_y(d));return this.opts.label+": "+val};Grapher.prototype.popup_date=function(d){return d.date};Grapher.prototype.get_x=function(d){return this.time_format.parse(d.date)};Grapher.prototype.get_y=function(d){if(this.opts.rate){return d.count*100}else{return d.count}};Grapher.prototype.get_x_scaled=function(){return this._x_scale(this.get_x.apply(this,arguments))};Grapher.prototype.get_y_scaled=function(){return this._y_scale(this.get_y.apply(this,arguments))};Grapher.prototype.format_y_axis=function(num){if(this.opts.rate){if(num<10&&num!==0){return I.number_format(num,1)+"%"}else{return I.number_format(num)+"%"}}else{return I.Grapher.format_number(num)}};Grapher.prototype.x_ticks=function(){return this.opts.x_ticks};Grapher.prototype.y_ticks=function(){if(this.opts.rate){return 5}else{return Math.min(5,this.opts.min_y)}};Grapher.prototype.get_range=function(){var format,left,new_left,offset,out,right,today;if(this.opts.interval!=="data"){if(this.opts.range_left){format=d3.time.format("%Y-%m-%d");out=[format.parse(this.opts.range_left),format.parse(this.opts.range_right)];if(this.opts.interval==="weekly"&&this.data[0]){format=d3.time.format("%Y-%m-%d");left=out[0];new_left=format.parse(this.data[0].date);while(new_left>left){new_left=d3.time.day.offset(new_left,-7)}return[new_left,out[1]]}return out}if(this.opts.num_days){today=d3.time.day(new Date);offset=this.opts.day_offset||0;left=d3.time.day.offset(today,-(this.opts.num_days+offset-1));right=d3.time.day.offset(today,-offset);return[left,right]}}format=d3.time.format("%Y-%m-%d");if(this.data.length<2){throw"Data is too small to get range"}return[format.parse(this.data[0].date),format.parse(this.data[this.data.length-1].date)];throw"Don't know how to calculate range"};Grapher.prototype.map_range=function(fn){var date,format,left,ref,res,results,right,t,val;if(this.opts.interval==="data"){format=d3.time.format("%Y-%m-%d");res=function(){var j,len,ref,results;ref=this.data;results=[];for(j=0,len=ref.length;j<len;j++){date=ref[j].date;val=fn(format.parse(date));if(!val){continue}results.push(val)}return results}.call(this);return res}ref=this.get_range(),left=ref[0],right=ref[1];t=left;results=[];while(t<=right){val=fn(t);t=this.increment_date(t);if(!val){continue}results.push(val)}return results};Grapher.prototype.list_range=function(){var out;out=[];this.map_range(function(d){return out.push(d)});return out};Grapher.prototype.increment_date=function(t){if(this.opts.interval==="weekly"){return d3.time.day.offset(t,7)}else{return d3.time.day.offset(t,1)}};Grapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var formatted;formatted=_this.time_format(t);return counts_by_date[formatted]||{count:0,date:formatted}}}(this))};Grapher.prototype.x_scale=function(data){var left,ref,right;ref=this.get_range(),left=ref[0],right=ref[1];return d3.time.scale().domain([left,right]).rangeRound([this.margin_left+this.axis_graph_padding,this.w-this.margin_right])};Grapher.prototype.y_scale=function(data){var axis_max_y,max,out,out_range,p;max=d3.max(data,this.get_y)||0;p=this.opts.y_axis_padding||1.3;out_range=[this.h-this.margin_bottom,this.margin_top];axis_max_y=this.opts.rate?Math.min(100,Math.max(.5,Math.floor(max*10*p)/10)):Math.max(this.opts.min_y,Math.floor((max+1)*p));out=d3.scale.linear().domain([0,axis_max_y]);if(this.opts.rate){return out.range(out_range)}else{return out.rangeRound(out_range)}};return Grapher}();I.MoneyGrapher=function(superClass){extend(MoneyGrapher,superClass);function MoneyGrapher(){this.format_y_axis=bind(this.format_y_axis,this);return MoneyGrapher.__super__.constructor.apply(this,arguments)}MoneyGrapher.prototype.format_y_axis=function(num){var dollars;dollars=this.opts.currency==="JPY"?num:num/100;if(dollars>9){Math.floor(dollars)}return(I.currency_symbols[this.opts.currency]||"$")+I.Grapher.format_number(dollars)};MoneyGrapher.prototype.popup_label=function(d){return this.opts.label+": "+I.format_money(d.sum,this.opts.currency)};return MoneyGrapher}(I.Grapher);I.CumulativeGraph=function(superClass){extend(CumulativeGraph,superClass);function CumulativeGraph(){this.get_range=bind(this.get_range,this);this.get_y=bind(this.get_y,this);return CumulativeGraph.__super__.constructor.apply(this,arguments)}CumulativeGraph.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8,fit_dots:true,min_range:7,currency:"USD",y_axis_padding:1.3};CumulativeGraph.prototype.get_y=function(d){return d.sum};CumulativeGraph.prototype.get_range=function(){var first,format,last,range_ago;format=d3.time.format("%Y-%m-%d");first=this.data[0];last=this.data[this.data.length-1];first=format.parse(first.date);last=format.parse(last.date);range_ago=d3.time.day.offset(last,-this.opts.min_range);if(range_ago<first){first=range_ago}return[first,last]};CumulativeGraph.prototype.format_data=function(){var by_date,j,last,len,ref,v;by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];by_date[v.date]=v}last=0;return this.map_range(function(_this){return function(t){var formatted,ref1;formatted=_this.time_format(t);last=((ref1=by_date[formatted])!=null?ref1.sum:void 0)||last;return{sum:last,date:formatted}}}(this))};return CumulativeGraph}(I.MoneyGrapher);I.BarGrapher=function(superClass){extend(BarGrapher,superClass);function BarGrapher(){this.get_x=bind(this.get_x,this);return BarGrapher.__super__.constructor.apply(this,arguments)}BarGrapher.prototype.chart_svg_class="chart bar_chart";BarGrapher.prototype.dot_hitbox_w=20;BarGrapher.prototype.dot_hitbox_h=20;BarGrapher.prototype.bar_spacing=5;BarGrapher.prototype.is_ordinal=function(){return this.opts.interval==="ordinal"};BarGrapher.prototype.x_field=function(){if(this.is_ordinal()){return"label"}else{return"date"}};BarGrapher.prototype.popup_date=function(d){return d[this.x_field()]};BarGrapher.prototype.get_x=function(d){if(this.is_ordinal()){return d[this.x_field()]}else{return BarGrapher.__super__.get_x.apply(this,arguments)}};BarGrapher.prototype.format_data=function(){if(this.is_ordinal()){return this.data}else{return BarGrapher.__super__.format_data.apply(this,arguments)}};BarGrapher.prototype.axis_offsets=function(){return[-Math.floor(this.bar_width()/2),0]};BarGrapher.prototype.map_range=function(fn){var j,len,ref,results,tuple;if(this.is_ordinal()){ref=this.data;results=[];for(j=0,len=ref.length;j<len;j++){tuple=ref[j];results.push(fn(tuple[this.x_field()]))}return results}else{return BarGrapher.__super__.map_range.apply(this,arguments)}};BarGrapher.prototype.get_range=function(){if(this.is_ordinal()){return[this.data[0][this.x_field()],this.data[this.data.length-1][this.x_field()]]}else{return BarGrapher.__super__.get_range.apply(this,arguments)}};BarGrapher.prototype.bar_width=function(){var bl,br;switch(this.opts.interval||"daily"){case"weekly":bl=this.get_range()[0];br=d3.time.day.offset(bl,7);break;case"daily":bl=this.get_range()[0];br=d3.time.day.offset(bl,1);break;case"data":bl=this.time_format.parse(this.data[0][this.x_field()]);br=this.time_format.parse(this.data[1][this.x_field()]);break;case"ordinal":bl=this.data[0][this.x_field()];br=this.data[1][this.x_field()]}return this._x_scale(br)-this._x_scale(bl)};BarGrapher.prototype.guide_x_range=function(x,y){var a,b,bw,range,ref;if(this.is_ordinal()){range=x.range();a=range[0];b=range[range.length-1]}else{ref=x.range(),a=ref[0],b=ref[1]}bw=this.bar_width();return[a-bw/2,b+bw/2]};BarGrapher.prototype.x_scale=function(data){var available_width,bar_width,bars,bh,d,j,keys,left,left_date,len,ref,right,right_date,tuple;left=this.margin_left+this.axis_graph_padding;right=this.w-this.margin_right;if(this.is_ordinal()){keys=[];ref=this.data;for(j=0,len=ref.length;j<len;j++){tuple=ref[j];keys.push(tuple[this.x_field()])}return d3.scale.ordinal().domain(keys).rangePoints([left,right])}else{bars=this.list_range();left_date=bars[0];right_date=bars[bars.length-1];available_width=right-left;d=d3.time.scale().domain([left_date,right_date]);bar_width=available_width/bars.length;bh=bar_width/2;return d.rangeRound([left+bh,right-bh])}};BarGrapher.prototype.draw_area=function(data){var bar_width,bars,colors,x_centered;if(this.opts.line_style==="line"){return BarGrapher.__super__.draw_area.apply(this,arguments)}bar_width=this.bar_width();x_centered=function(_this){return function(d){var x;x=_this.get_x_scaled(d);return x-(bar_width-_this.bar_spacing)/2}}(this);bars=this.svg.append("g").attr("class","bars").selectAll("rect").data(data).enter().append("rect").attr("x",x_centered).attr("y",this.get_y_scaled).attr("width",bar_width-this.bar_spacing).attr("height",function(_this){return function(d){return _this._y_scale(0)-_this.get_y_scaled(d)}}(this));if(this.opts.colors){colors=d3.scale.ordinal().range(this.opts.colors);colors=colors.domain(this._x_scale.domain());bars=bars.attr("fill",function(_this){return function(d){return colors(d[_this.x_field()])}}(this))}return bars};return BarGrapher}(I.Grapher);I.StackedBarGrapher=function(superClass){extend(StackedBarGrapher,superClass);StackedBarGrapher.prototype.chart_svg_class="chart bar_chart stacked_bar_chart";StackedBarGrapher.prototype.bar_popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_group">{{ group }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';function StackedBarGrapher(){this.on_hide_popup=bind(this.on_hide_popup,this);this.on_show_popup=bind(this.on_show_popup,this);this.popup_group=bind(this.popup_group,this);StackedBarGrapher.__super__.constructor.apply(this,arguments);if(this.opts.group_url){$(this.svg.node()).on("click","[data-game_id]",function(_this){return function(e){var id,url;id=$(e.target).data("game_id");url=_this.opts.group_url({game_id:id});if(!url){return}return window.location=url}}(this))}if(this.opts.column_url){$(this.svg.node()).on("click",".column_dot[data-popup]",function(_this){return function(e){var data,url;data=$(e.target).data("popup");url=_this.opts.column_url(data);if(!url){return}return window.location=url}}(this))}}StackedBarGrapher.prototype.secondary_field=function(){return this.opts.secondary_field||"game_id"};StackedBarGrapher.prototype.get_y=function(d){return d.max};StackedBarGrapher.prototype.x_ticks=function(){if(this.opts.interval==="weekly"){if(this.list_range().length<15){return d3.time.monday}}return StackedBarGrapher.__super__.x_ticks.apply(this,arguments)};StackedBarGrapher.prototype.popup_group=function(d){return d[this.secondary_field()]};StackedBarGrapher.prototype.bar_popup_label=function(d){var val;val=I.number_format(d.max-d.min);return this.opts.label+": "+val};StackedBarGrapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var count,formatted,idx,last_sum,stacks,sum,tuple,x;formatted=_this.time_format(t);tuple=counts_by_date[formatted];if(!tuple){return{date:formatted,min:0,max:0,stacks:[]}}sum=0;stacks=function(){var k,len1,ref1,results;ref1=tuple.counts;results=[];for(idx=k=0,len1=ref1.length;k<len1;idx=++k){count=ref1[idx];last_sum=sum;sum+=count.count;x={cap:sum===tuple.count,date:tuple.date,min:last_sum,max:sum};x[this.secondary_field()]=count[this.secondary_field()];results.push(x)}return results}.call(_this);if(!(tuple.count>0)){return}return{date:tuple.date,min:0,max:tuple.count,stacks:stacks}}}(this))};StackedBarGrapher.prototype.popup_position=function(hitbox){return calculate_offset(hitbox,this.el)};StackedBarGrapher.prototype.on_show_popup=function(popup,hitbox){var current_bars,game_bars,secondary_id;secondary_id=hitbox.data(this.secondary_field());if(!secondary_id){this.on_hide_popup();return}this.el.addClass("highlighting_bar");game_bars=this.el.find(".game_bar");current_bars=game_bars.filter("[data-"+this.secondary_field()+"='"+secondary_id+"']");game_bars.css({opacity:.1});return current_bars.css({opacity:""})};StackedBarGrapher.prototype.on_hide_popup=function(popup,hitbox){return this.el.removeClass("highlighting_bar").find(".game_bar").css({opacity:""})};StackedBarGrapher.prototype.draw_area=function(data){var bar_stack,bar_stacks,bar_width,colors,g,item,j,len,position_bars,secondary_ids,stack;bar_width=this.bar_width();colors=d3.scale.ordinal().range(this.opts.colors||["#F3596A","#D34D75","#AE4879","#864477","#5E406D","#39385E"]);data=data.filter(function(d){return d.min!==d.max});secondary_ids={};for(j=0,len=data.length;j<len;j++){item=data[j];secondary_ids[item[this.secondary_field()]]=true}secondary_ids=function(){var results;results=[];for(g in secondary_ids){results.push(+g)}return results}();colors=colors.domain(secondary_ids);stack=this.svg.append("g").attr("class","bars").selectAll("g").data(data).enter().append("g");position_bars=function(_this){return function(group,expand){if(expand==null){expand=0}return group.attr("x",function(d){var x;x=_this.get_x_scaled(d);return-expand+Math.floor(x-(bar_width-5)/2)}).attr("y",function(d){return _this._y_scale(d.max)-expand}).attr("width",bar_width-5+expand*2).attr("height",function(d){return 2*expand+Math.max(1,_this._y_scale(d.min)-_this._y_scale(d.max))})}}(this);bar_stack=stack.attr("class","bar_stack");position_bars(bar_stack.append("rect").attr("class","total_border"),1);position_bars(bar_stack.append("rect").attr("class","total_bar"));bar_stacks=stack.append("g").attr("class","game_counts").selectAll("rect").data(function(d){return d.stacks}).enter();position_bars(bar_stacks.append("rect").attr("class",function(_this){return function(d){var base,c;c="game_bar hitbox";if(typeof(base=_this.opts).group_url==="function"?base.group_url(d):void 0){c+=" link"}return c}}(this)).attr("data-"+this.secondary_field(),function(_this){return function(d){return d[_this.secondary_field()]}}(this)).attr("fill",function(_this){return function(d){return colors(d[_this.secondary_field()])}}(this)).attr("data-popup_template","bar_popup_template").attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.bar_popup_label.apply(_this,arguments),group:(_this.opts.popup_group||_this.popup_group).apply(null,arguments)})}}(this)));return position_bars(bar_stacks.append("rect").attr("class","bar_border")).attr("height",function(d){if(d.cap){return 0}else{return 1}})};return StackedBarGrapher}(I.BarGrapher)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityArchiveTopicLightbox=function(superClass){extend(CommunityArchiveTopicLightbox,superClass);function CommunityArchiveTopicLightbox(){this.init=bind(this.init,this);return CommunityArchiveTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityArchiveTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityArchiveTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityBanLightbox=function(superClass){extend(CommunityBanLightbox,superClass);function CommunityBanLightbox(){this.init=bind(this.init,this);return CommunityBanLightbox.__super__.constructor.apply(this,arguments)}CommunityBanLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return _this.el.addClass("after_ban")}}(this))};return CommunityBanLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityCategoryBans=function(){function CommunityCategoryBans(el){this.el=$(el);this.el.remote_link(function(_this){return function(res){if(res.errors){alert(res.errors.join("\n"));return}return window.location.reload()}}(this))}return CommunityCategoryBans}()}).call(this);(function(){I.CommunityCategoryModerators=function(){function CommunityCategoryModerators(el){this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(res.return_to){return window.location=res.return_to}}}(this))}return CommunityCategoryModerators}()}).call(this);(function(){I.CommunityProfile=function(){function CommunityProfile(el,opts){var c;this.el=$(el);new I.FilterPickers(this.el);this.carousels=function(){var i,len,ref,results;ref=this.el.find(".game_carousel_widget");results=[];for(i=0,len=ref.length;i<len;i++){c=ref[i];results.push(new I.GameCarousel($(c)))}return results}.call(this);new I.CommunityViewTopic(this.el.find(".recent_posts"),opts)}return CommunityProfile}()}).call(this);(function(){I.CommunityEditCategory=function(){function CommunityEditCategory(el){var form;this.el=$(el);form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}return CommunityEditCategory}()}).call(this);(function(){I.GameCommunityCategory=function(){function GameCommunityCategory(el){var scroller;this.el=$(el);scroller=this.el.find(".blog_post_grid_widget");scroller.lazy_images({horizontal:true,target:scroller})}return GameCommunityCategory}()}).call(this);(function(){I.GameCommunityHeader=function(){function GameCommunityHeader(el){this.el=$(el);this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})}return GameCommunityHeader}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityLockTopicLightbox=function(superClass){extend(CommunityLockTopicLightbox,superClass);function CommunityLockTopicLightbox(){this.init=bind(this.init,this);return CommunityLockTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityLockTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityLockTopicLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityNewTopic=function(){function CommunityNewTopic(el,opts){var form;this.el=$(el);try{this.el.find("input[name=offset]").val((new Date).getTimezoneOffset())}catch(error){}this.set_fingerprint();form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}CommunityNewTopic.prototype.set_fingerprint=function(){if(!window.Fingerprint2){return false}this.set_fingerprint=function(){};return(new Fingerprint2).get(function(_this){return function(res){if(res){return _this.el.find("input[name=bfp]").val(res)}}}(this))};return CommunityNewTopic}()}).call(this);(function(){I.CommunityPostForm=function(){function CommunityPostForm(el,opts){var form;if(opts==null){opts={}}this.el=$(el);form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){window.location=res.redirect_to}if(res.flash){return I.flash(res.flash)}}}(this))}return CommunityPostForm}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityReportPostLightbox=function(superClass){extend(CommunityReportPostLightbox,superClass);function CommunityReportPostLightbox(){this.init=bind(this.init,this);return CommunityReportPostLightbox.__super__.constructor.apply(this,arguments)}CommunityReportPostLightbox.prototype.init=function(){var form;return form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return _this.el.addClass("submitted_report")}}(this))};return CommunityReportPostLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityStickTopicLightbox=function(superClass){extend(CommunityStickTopicLightbox,superClass);function CommunityStickTopicLightbox(){this.init=bind(this.init,this);return CommunityStickTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityStickTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityStickTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicHeader=function(){function CommunityTopicHeader(el,opts){var moderation;this.opts=opts;this.render_topic_voter=bind(this.render_topic_voter,this);this.el=$(el);moderation=this.el.find(".moderation_tools");if(moderation.length){new I.CommunityTopicModerationTools(moderation,this.opts.moderation)}this.render_topic_voter()}CommunityTopicHeader.prototype.render_topic_voter=function(){var props,ref,voter;if(!(typeof R!=="undefined"&&R!==null?(ref=R.Community)!=null?ref.TopicVoter:void 0:void 0)){return}voter=this.el.find(".community_topic_voter_widget");if(!voter.length){return}props=voter.data("p");props.vote_url=this.opts.vote_url;return ReactDOM.render(R.Community.TopicVoter(props),voter[0])};return CommunityTopicHeader}()}).call(this);(function(){I.CommunityTopicList=function(){function CommunityTopicList(el,opts){this.opts=opts;this.el=$(el);new I.CommunityTopicModerationTools(el,this.opts);this.el.lazy_images({selector:"[data-background_image]"});this.render_topic_voters();this.el.has_tooltips();new I.GamePopups(this.el)}CommunityTopicList.prototype.render_topic_voters=function(){var i,len,props,ref,ref1,results,voter;if(!(typeof R!=="undefined"&&R!==null?(ref=R.Community)!=null?ref.TopicVoter:void 0:void 0)){return}ref1=this.el.find(".community_topic_voter_widget");results=[];for(i=0,len=ref1.length;i<len;i++){voter=ref1[i];props=$(voter).data("p");props.vote_url=this.opts.vote_url;results.push(ReactDOM.render(R.Community.TopicVoter(props),voter))}return results};return CommunityTopicList}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicModerationTools=function(){CommunityTopicModerationTools.prototype.topic_url=function(route,topic_id){return this.opts.urls[route].replace(/:topic_id\b/,topic_id)};function CommunityTopicModerationTools(el,opts){this.opts=opts;this.topic_url=bind(this.topic_url,this);this.el=$(el);new I.FilterPickers(el);this.el.on("click",".filter_option",function(_this){return function(e){var target,topic_id,value;target=$(e.currentTarget).trigger("i:close_filter_pickers");topic_id=target.closest("[data-topic_id]").data("topic_id");value=target!=null?target.data("value"):void 0;switch(value){case"purge":e.preventDefault();if(confirm("This will delete all the users posts and spam their account. No undo. Are you sure?")){return $.post($(e.currentTarget).attr("href"),I.with_csrf()).done(function(res){if(res.errors){alert(res.errors.join(","));return}if(res.redirect_to){return window.location=res.redirect_to}})}break;case"feature":case"unfeature":case"bump":e.preventDefault();return $.post($(e.currentTarget).attr("href"),I.with_csrf()).done(function(res){if(res.errors){alert(res.errors.join(","));return}if(res.redirect_to){return window.location=res.redirect_to}});case"archive":case"unarchive":e.preventDefault();return I.Lightbox.open_remote(_this.topic_url("archive_topic",topic_id),I.CommunityArchiveTopicLightbox);case"lock":case"unlock":e.preventDefault();return I.Lightbox.open_remote(_this.topic_url("lock_topic",topic_id),I.CommunityLockTopicLightbox);case"stick":case"unstick":e.preventDefault();return I.Lightbox.open_remote(_this.topic_url("stick_topic",topic_id),I.CommunityStickTopicLightbox);case"delete":e.preventDefault();if(confirm("Are you sure you want to delete this topic?")){return $.ajax({url:_this.topic_url("delete_topic",topic_id),data:I.with_csrf(),type:"post",xhrFields:{withCredentials:true}}).done(function(res){if(res.errors){return alert(res.errors.join())}return window.location.reload()})}}}}(this))}return CommunityTopicModerationTools}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityViewTopic=function(){CommunityViewTopic.prototype.vote_counts_template=I.lazy_template(CommunityViewTopic,"vote_counts");function CommunityViewTopic(el,opts){this.opts=opts;this.update_votes=bind(this.update_votes,this);this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(el.is(".vote_btn")){if(res.errors){alert(res.errors.join(", "));return}_this.update_votes(el,res);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this));this.el.dispatch("click",{ban_user_btn:function(_this){return function(btn){var ban_url,post;post=btn.closest(".community_post").data("post");ban_url=_this.opts.ban_url+("?banned_user_id="+post.user_id);return I.Lightbox.open_remote(ban_url,I.CommunityBanLightbox)}}(this),stick_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityStickTopicLightbox)}}(this),lock_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityLockTopicLightbox)}}(this),report_post_btn:function(_this){return function(btn){var post,url;post=btn.closest(".community_post").data("post");url=_this.opts.report_url.replace(/:post_id/,post.id);return I.Lightbox.open_remote(url,I.CommunityReportPostLightbox)}}(this),embed_preload:function(_this){return function(btn){var code;if(btn[0].hasAttribute("itchio")){code=btn.data("embed_code");return btn.replaceWith(code)}}}(this)})}CommunityViewTopic.prototype.update_votes=function(el,res){var i,len,like_button,post,v,voters;post=el.closest(".community_post");voters=post.find(".vote_btn");like_button=voters.filter(".post_action");like_button.removeClass("animate_bounce animate_drop_down");setTimeout(function(_this){return function(){return like_button.removeClass("animate_bounce animate_drop_down")}}(this),500);if(el.is(".voted")){_.defer(function(_this){return function(){return like_button.addClass("animate_drop_down")}}(this));el.removeClass("voted")}else{_.defer(function(_this){return function(){return like_button.addClass("animate_bounce")}}(this));voters.removeClass("voted").filter(el).addClass("voted")}for(i=0,len=voters.length;i<len;i++){v=voters[i];v=$(v);if(v.is(".voted")){v.data("params").action="remove"}else{delete v.data("params").action}}return post.find(".vote_counts").html(this.vote_counts_template({up_score:res.up_score+Math.max(0,res.score_adjustment),down_score:res.down_score+Math.abs(Math.min(0,res.score_adjustment))}))};return CommunityViewTopic}()}).call(this);
